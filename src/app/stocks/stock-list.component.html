<div class="max-w-7xl mx-auto px-4 py-6">
  <div class="flex flex-wrap -mx-2">
    <div class="w-full px-2">
    <!-- Page Header -->
    <div class="bg-white rounded-2xl shadow-lg border-0 mb-4">
      <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-4 rounded-t-2xl">
        <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-3">
          <div class="flex items-center">
            <div class="w-14 h-14 bg-white/20 text-white rounded-full flex items-center justify-center mr-3 text-xl">
              <i class="fas fa-boxes"></i>
            </div>
            <div>
              <h1 class="text-2xl font-black text-white font-akira mb-1">Stock Management</h1>
              <small class="text-white/80 font-inter text-sm">Manage and track your inventory stock levels</small>
            </div>
          </div>
          <div class="flex flex-wrap gap-2">
            <a routerLink="/dispose" class="inline-flex items-center justify-center rounded-md px-3 py-2 font-semibold transition bg-white text-red-600 hover:bg-gray-100 shadow-sm text-sm" *ngIf="hasRole([Role.SuperAdmin, Role.Admin, Role.Staff, Role.Viewer])">
              <i class="fas fa-trash-alt mr-1"></i>
              View Disposals
            </a>
            <a routerLink="/pc" class="inline-flex items-center justify-center rounded-md px-3 py-2 font-semibold transition bg-white text-gray-700 hover:bg-gray-100 shadow-sm text-sm">
              <i class="fas fa-desktop mr-1"></i> View PCs
            </a>
            <button class="inline-flex items-center justify-center rounded-md px-3 py-2 font-semibold transition bg-warning text-white hover:bg-yellow-600 shadow-sm text-sm" (click)="openAddStockModal()">
              <i class="fas fa-plus mr-1"></i>
              Add Stock
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 text-center hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
        <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center mx-auto mb-3">
          <i class="fas fa-minus-circle text-white text-xl"></i>
        </div>
        <div class="text-2xl font-bold text-gray-900 font-akira mb-1">{{ getDisposalsCount() }}</div>
        <div class="text-xs text-gray-600 font-inter uppercase tracking-wide">Stock Disposals</div>
      </div>
      <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 text-center hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
        <div class="w-12 h-12 bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl flex items-center justify-center mx-auto mb-3">
          <i class="fas fa-dollar-sign text-white text-xl"></i>
        </div>
        <div class="text-2xl font-bold text-gray-900 font-akira mb-1">php{{ getTotalValue() | number:'1.0-0' }}</div>
        <div class="text-xs text-gray-600 font-inter uppercase tracking-wide">Total Value</div>
      </div>
    </div>

    <!-- Filters and Search -->
    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-5 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
            <i class="fas fa-search text-gray-400"></i>
          </div>
          <input 
            type="text" 
            class="w-full pl-11 pr-4 py-3 border-2 border-gray-200 rounded-full focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 focus:outline-none transition-all duration-200 font-inter" 
            placeholder="Search stocks..."
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
          >
        </div>
        <div>
          <select class="w-full px-4 py-3 border-2 border-gray-200 rounded-full focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 focus:outline-none transition-all duration-200 font-inter" [(ngModel)]="selectedCategory" (change)="onFilterChange()">
            <option value="">All Categories</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="flex flex-col items-center justify-center py-12">
      <div class="inline-block w-12 h-12 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
      <p class="mt-4 text-gray-600 font-inter">Loading stocks...</p>
    </div>

    <!-- Stock Table -->
    <div *ngIf="!loading" class="bg-white rounded-xl shadow-md border border-gray-200 mb-6">
      <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-4 rounded-t-xl flex items-center justify-between">
        <h5 class="text-lg font-semibold flex items-center gap-2 font-montserrat">
          <i class="fas fa-list"></i> Stock Entries
          </h5>
          <div class="flex gap-2">
          <button class="inline-flex items-center justify-center rounded-md px-3 py-1.5 text-sm font-semibold transition bg-white/20 hover:bg-white/30 text-white" (click)="refreshData()">
            <i class="fas fa-sync-alt mr-1"></i>
              Refresh
            </button>
        </div>
      </div>
      <div class="p-0">
        <div class="overflow-hidden">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th class="text-center">
                  <i class="fas fa-box me-1 text-primary"></i> Item Name
                </th>
                <th class="text-center">
                  <i class="fas fa-tag me-1 text-primary"></i> Category
                </th>
                <th class="text-center">
                  <i class="fas fa-trademark me-1 text-primary"></i> Brand
                </th>
                <th class="text-center">
                  <i class="fas fa-map-marker-alt me-1 text-primary"></i> Location
                </th>
                <th class="text-center">
                  <i class="fas fa-sort-numeric-up me-1 text-primary"></i> Quantity
                </th>
                <th class="text-center">
                  <i class="fas fa-cogs me-1 text-primary"></i> Actions
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let stock of paginatedStocks" [attr.data-item-id]="stock.itemId">
                <!-- Item Name -->
                <td class="text-center align-middle">
                    <strong class="font-montserrat text-sm font-semibold">{{ stock.item?.name || getItemName(stock.itemId) }}</strong>
                </td>
                
                <!-- Category -->
                <td class="text-center align-middle">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    {{ stock.item?.category?.name || getCategoryName(stock) }}
                  </span>
                </td>
                
                <!-- Brand -->
                <td class="text-center align-middle">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                    {{ stock.item?.brand?.name || getBrandName(stock) }}
                  </span>
                </td>
                
                <!-- Location -->
                <td class="text-center align-middle">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    <i class="fas fa-map-marker-alt mr-1"></i>
                    {{ stock.location?.name || getLocationNameByStock(stock) }}
                  </span>
                </td>
                
                <!-- Quantity -->
                <td class="text-center align-middle">
                  <span class="inline-flex items-center px-3 py-1.5 rounded-full text-sm font-semibold" [ngClass]="{
                    'bg-green-100 text-green-800': isItemEffectivelyAvailable(stock) && stock.quantity > 0,
                    'bg-red-100 text-red-800': stock.disposeId && !stock.disposal?.returnedToStock,
                    'bg-gray-100 text-gray-800': stock.quantity === 0
                    }">
                      {{ stock.quantity }}
                    </span>
                </td>
                
                <!-- Actions -->
                <td class="text-center align-middle">
                  <div class="flex flex-row gap-1 justify-center">
                    <button type="button" class="inline-flex items-center justify-center w-8 h-8 rounded-md transition bg-blue-50 text-blue-700 hover:bg-blue-100 border border-blue-200"
                            (click)="openViewStockModal(stock)" title="View Full Details">
                      <i class="fas fa-eye text-sm"></i>
                    </button>
                    <button type="button" class="inline-flex items-center justify-center w-8 h-8 rounded-md transition bg-yellow-50 text-yellow-700 hover:bg-yellow-100 border border-yellow-200"
                            (click)="openEditStockModal(stock)" title="Edit Stock"
                            *ngIf="hasRole([Role.SuperAdmin, Role.Admin, Role.Staff])">
                      <i class="fas fa-edit text-sm"></i>
                    </button>
                    <button type="button" class="inline-flex items-center justify-center w-8 h-8 rounded-md transition bg-teal-50 text-teal-700 hover:bg-teal-100 border border-teal-200"
                            (click)="navigateToDispose(stock)" title="Dispose Stock"
                            *ngIf="isItemEffectivelyAvailable(stock) && hasRole([Role.SuperAdmin, Role.Admin, Role.Staff])">
                      <i class="fas fa-recycle text-sm"></i>
                    </button>
                    <button type="button" class="inline-flex items-center justify-center w-8 h-8 rounded-md transition bg-red-50 text-red-700 hover:bg-red-100 border border-red-200"
                            (click)="confirmDeleteStock(stock)" title="Delete Stock Entry"
                            *ngIf="hasRole([Role.SuperAdmin, Role.Admin])">
                      <i class="fas fa-trash text-sm"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filteredStocks.length === 0">
                <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                  <div class="empty-state">
                    <i class="fas fa-box-open text-4xl mb-4"></i>
                    <h4 class="text-lg font-semibold mb-2 font-montserrat">No stock entries found</h4>
                    <p class="text-sm font-inter">Try adjusting your search or filters</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-section" *ngIf="filteredStocks.length > 0">
      <div class="pagination-info">
        Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, filteredStocks.length) }} of {{ filteredStocks.length }} entries
      </div>
      <nav aria-label="Stock pagination">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="previousPage()">
              <i class="fas fa-chevron-left"></i>
            </a>
          </li>
          <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage">
            <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="nextPage()">
              <i class="fas fa-chevron-right"></i>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<!-- Add Stock Modal -->
<div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4" *ngIf="showAddStockModal" (click)="closeAddStockModal()">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[95vh] overflow-hidden" (click)="$event.stopPropagation()">
    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-4">
      <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
        <div class="flex items-center">
          <div class="w-14 h-14 bg-white/20 text-white rounded-full flex items-center justify-center mr-4 text-xl">
            <i class="fas fa-plus"></i>
          </div>
          <div>
            <h1 class="text-2xl font-black text-white font-akira mb-1">Add New Item</h1>
            <p class="text-white/80 font-inter text-sm">Add new stock items to your inventory</p>
          </div>
        </div>
        <button type="button" class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 text-white transition" (click)="closeAddStockModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      </div>

    <div class="p-6 max-h-[calc(95vh-120px)] overflow-y-auto">
        <!-- Add Stock Form Content -->
      <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
        <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b border-gray-200 flex justify-between items-center">
          <h5 class="text-lg font-semibold text-gray-900 flex items-center gap-2 font-montserrat">
            <i class="fas fa-edit text-indigo-600"></i> 
            Stock Information
            </h5>
          <button type="button" class="inline-flex items-center justify-center rounded-md px-3 py-2 font-semibold transition bg-green-600 text-white hover:bg-green-700 shadow-sm text-sm" (click)="addNewStockEntry()">
            <i class="fas fa-plus mr-1"></i> Add New Item
            </button>
          </div>
          <div class="p-6">
            <form (ngSubmit)="onFormSubmit($event)" #stockForm="ngForm" class="space-y-6">
              
              <!-- Multiple Stock Entries -->
              <div *ngFor="let entry of stockEntries; let i = index; trackBy: trackByIndex" class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                <div class="flex justify-between items-center mb-4">
                  <h6 class="text-lg font-semibold text-gray-900 flex items-center gap-2 font-montserrat">
                    <i class="fas fa-box text-indigo-600"></i>Stock Entry {{ i + 1 }}
                  </h6>
                  <button 
                    type="button" 
                    class="inline-flex items-center justify-center w-8 h-8 rounded-md transition bg-red-50 text-red-700 hover:bg-red-100 border border-red-200" 
                    (click)="removeStockEntry(i)"
                    *ngIf="stockEntries.length > 1"
                    title="Remove this entry"
                  >
                    <i class="fas fa-trash text-sm"></i>
                  </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                  <!-- Item Selection -->
                  <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-700 flex items-center gap-2">
                      <i class="fas fa-tag text-indigo-600"></i> 
                      Item <span class="text-red-500">*</span>
                    </label>
                    <select 
                      class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 focus:outline-none transition-all duration-200 font-inter" 
                      [class.border-red-500]="stockSubmitted && !entry.itemId"
                      [(ngModel)]="entry.itemId" 
                      [name]="'itemId_' + i" 
                      required 
                      (change)="calculateTotalPrice()"
                    >
                      <option value="" disabled>Select Item</option>
                      <option *ngFor="let item of items" [ngValue]="item.id">
                        {{ item.name }} ({{ item.category?.name || 'No Category' }})
                      </option>
                    </select>
                    <div class="text-red-500 text-sm mt-1" *ngIf="stockSubmitted && !entry.itemId">
                      Please select an item
                    </div>
                  </div>

                  <!-- Quantity -->
                  <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-700 flex items-center gap-2">
                      <i class="fas fa-sort-numeric-up text-indigo-600"></i> 
                      Quantity <span class="text-red-500">*</span>
                    </label>
                    <input 
                      type="number" 
                      class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 focus:outline-none transition-all duration-200 font-inter" 
                      [class.border-red-500]="stockSubmitted && (!entry.quantity || entry.quantity <= 0)"
                      [(ngModel)]="entry.quantity" 
                      [name]="'quantity_' + i" 
                      required
                      min="1"
                      (input)="calculateTotalPrice()"
                      placeholder="Enter quantity"
                    >
                    <div class="text-red-500 text-sm mt-1" *ngIf="stockSubmitted && (!entry.quantity || entry.quantity <= 0)">
                      Quantity must be greater than 0
                    </div>
                  </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mt-4">
                  <!-- Price -->
                  <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-700 flex items-center gap-2">
                      <i class="fas fa-dollar-sign text-indigo-600"></i> 
                      Price (per item) <span class="text-red-500">*</span>
                    </label>
                    <input 
                      type="number" 
                      class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 focus:outline-none transition-all duration-200 font-inter" 
                      [class.border-red-500]="stockSubmitted && (!entry.price || entry.price <= 0)"
                      [(ngModel)]="entry.price" 
                      [name]="'price_' + i" 
                      step="0.01"
                      required
                      (input)="calculateTotalPrice()"
                      placeholder="Enter price"
                    >
                    <div class="text-red-500 text-sm mt-1" *ngIf="stockSubmitted && (!entry.price || entry.price <= 0)">
                      Price must be greater than 0
                    </div>
                  </div>

                  <!-- Storage Location -->
                  <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-700 flex items-center gap-2">
                      <i class="fas fa-map-marker-alt text-indigo-600"></i> 
                      Storage Location <span class="text-red-500">*</span>
                    </label>
                    <select 
                      class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 focus:outline-none transition-all duration-200 font-inter" 
                      [class.border-red-500]="stockSubmitted && !entry.locationId"
                      [(ngModel)]="entry.locationId" 
                      [name]="'locationId_' + i" 
                      required
                    >
                      <option value="" disabled>Select Location</option>
                      <option *ngFor="let location of locations" [ngValue]="location.id">
                        {{ location.name }}
                      </option>
                    </select>
                    <div class="text-red-500 text-sm mt-1" *ngIf="stockSubmitted && !entry.locationId">
                      Please select a storage location
                    </div>
                  </div>
                </div>

                <div class="mt-4">
                  <!-- Remarks -->
                  <div class="space-y-2">
                    <label class="block text-sm font-semibold text-gray-700 flex items-center gap-2">
                      <i class="fas fa-comment text-indigo-600"></i> 
                      Remarks
                    </label>
                    <input 
                      type="text" 
                      class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 focus:outline-none transition-all duration-200 font-inter" 
                      [(ngModel)]="entry.remarks" 
                      [name]="'remarks_' + i" 
                      placeholder="Optional remarks"
                    >
                  </div>
                </div>
              </div>

              <!-- Total Price Summary -->
              <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex justify-between items-center">
                  <span class="flex items-center gap-2 text-blue-800 font-semibold">
                    <i class="fas fa-calculator"></i> 
                    <strong>Total Price for All Items:</strong>
                  </span>
                  <span class="text-2xl font-bold text-blue-900">₱{{ totalPrice | number:'1.2-2' }}</span>
                </div>
              </div>

              <!-- Single Receipt Upload for All Items -->
              <div class="space-y-2">
                <label class="block text-sm font-semibold text-gray-700 flex items-center gap-2">
                  <i class="fas fa-receipt text-indigo-600"></i> 
                  Receipt Photo (Optional)
                    </label>
                    <input 
                      type="file" 
                  class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 focus:outline-none transition-all duration-200 font-inter" 
                      accept="image/*"
                      (change)="onReceiptFileSelected($event)"
                      name="stock_receipt"
                    >
                <small class="text-gray-500 text-sm">
                      Upload one receipt photo for all items in this stock entry (JPG, PNG, GIF - Max 5MB)
                    </small>
              </div>
              
              <!-- Action Buttons - MOVED INSIDE FORM -->
              <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t border-gray-200">
                <button type="button" class="inline-flex items-center justify-center rounded-md px-4 py-2 font-semibold transition bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-300" (click)="closeAddStockModal()">
                  <i class="fas fa-times mr-2"></i>
                  Cancel
                </button>
                <button type="submit" class="inline-flex items-center justify-center rounded-md px-4 py-2 font-semibold transition bg-indigo-600 text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed">
                  <div *ngIf="stockLoading" class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"></div>
                  <i *ngIf="!stockLoading" class="fas fa-save mr-2"></i>
                  <span *ngIf="!stockLoading">Add {{ stockEntries.length }} Stock Item(s)</span>
                  <span *ngIf="stockLoading">Adding Stock Items...</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    <div class="flex flex-col sm:flex-row gap-3 p-6 border-t border-gray-200 bg-gray-50" style="display: none;">
      <!-- OLD BUTTONS REMOVED - NOW INSIDE FORM -->
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<app-confirmation-modal-new
  [isVisible]="showConfirmationModalFlag"
  [title]="'Confirm Stock Addition'"
  [message]="'Please review the items you are about to add:'"
  [items]="validStockEntries"
  [allItems]="items"
  [allLocations]="locations"
  [userRole]="currentUserRole"
  [confirmText]="confirmButtonText"
  [isLoading]="stockLoading"
  (confirmed)="proceedWithSave()"
  (cancelled)="hideConfirmationModal()">
</app-confirmation-modal-new>

<!-- View Stock Modal -->
<div class="modal-overlay" *ngIf="showViewStockModal" (click)="closeViewStockModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-title">
          <i class="fas fa-eye"></i>
          <div>
            <h1 class="page-title">Stock Details</h1>
            <p class="page-subtitle">View detailed stock information</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-close" (click)="closeViewStockModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="modal-body">
      <div class="form-card">
        <div class="card">
          <div class="card-header">
            <h5><i class="fas fa-info-circle"></i> Stock Information</h5>
          </div>
          <div class="card-body">
            <div *ngIf="selectedStock">
              <!-- Enhanced Stock Details Grid -->
              <div class="stock-details-grid">
                <!-- Stock ID -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-hashtag"></i> Stock ID
                  </div>
                  <div class="detail-value highlight">{{ selectedStock.id }}</div>
                </div>

                <!-- Stock Name -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-box"></i> Stock Name
                  </div>
                  <div class="detail-value">{{ getItemName(selectedStock.itemId) }}</div>
                </div>

                <!-- Brand -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-trademark"></i> Brand
                  </div>
                  <div class="detail-value">{{ getBrandName(selectedStock) }}</div>
                </div>

                <!-- Category -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-tag"></i> Category
                  </div>
                  <div class="detail-value">{{ getCategoryName(selectedStock) }}</div>
                </div>

                <!-- Date Added -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-calendar-alt"></i> Date Added
                  </div>
                  <div class="detail-value">{{ selectedStock.createdAt | date:'MMM dd, yyyy' }}</div>
                </div>

                <!-- Time Added -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-clock"></i> Time Added
                  </div>
                  <div class="detail-value">{{ selectedStock.createdAt | date:'HH:mm:ss' }}</div>
                </div>

                <!-- Storage Location -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-map-marker-alt"></i> Storage Location
                  </div>
                  <div class="detail-value">{{ getLocationNameByStock(selectedStock) }}</div>
                </div>

                <!-- Quantity -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-sort-numeric-up"></i> Quantity
                  </div>
                  <div class="detail-value" [ngClass]="selectedStock.quantity > 0 ? 'success' : 'danger'">
                    {{ selectedStock.quantity }} units
                  </div>
                </div>

                <!-- Price -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-dollar-sign"></i> Price (per item)
                  </div>
                  <div class="detail-value warning">₱{{ selectedStock.price | number:'1.2-2' }}</div>
                </div>

                <!-- Total Value -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-calculator"></i> Total Value
                  </div>
                  <div class="detail-value success">₱{{ (selectedStock.quantity * selectedStock.price) | number:'1.2-2' }}</div>
                </div>
              </div>

              <!-- Remarks Section -->
              <div class="detail-item" *ngIf="selectedStock.remarks">
                <div class="detail-label">
                  <i class="fas fa-comment"></i> Remarks
                </div>
                <div class="detail-value">{{ selectedStock.remarks }}</div>
              </div>

              <!-- Receipt Section -->
              <div class="detail-item">
                <div class="detail-label">
                  <i class="fas fa-receipt"></i> Receipt Photo
                </div>
                <div class="detail-value">
                  <div class="receipt-container" *ngIf="selectedStock.receiptAttachment; else noReceiptTemplate">
                    <img 
                      [src]="getReceiptUrl(selectedStock.receiptAttachment)" 
                      alt="Receipt Photo" 
                      class="receipt-image"
                      (click)="openReceiptModal(selectedStock.receiptAttachment)"
                      style="cursor: pointer; max-width: 200px; max-height: 150px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"
                      (error)="onReceiptImageError($event)"
                      (load)="onReceiptImageLoad($event)"
                      onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
                    >
                    <div class="receipt-placeholder" style="display: none; max-width: 200px; max-height: 150px; border: 2px dashed #ccc; border-radius: 8px; padding: 20px; text-align: center; background: #f9f9f9;">
                      <i class="fas fa-receipt" style="font-size: 2rem; color: #ccc; margin-bottom: 10px;"></i>
                      <p style="margin: 0; color: #666; font-size: 0.9rem;">Receipt Image<br><small>File: {{ selectedStock.receiptAttachment }}</small></p>
                    </div>
                    <div class="receipt-actions mt-2">
                      <button class="btn btn-sm btn-outline-primary" (click)="openReceiptModal(selectedStock.receiptAttachment)">
                        <i class="fas fa-expand"></i> View Full Size
                      </button>
                    </div>
                  </div>
                  <ng-template #noReceiptTemplate>
                    <div class="no-receipt-placeholder" style="max-width: 200px; max-height: 150px; border: 2px dashed #ccc; border-radius: 8px; padding: 20px; text-align: center; background: #f9f9f9;">
                      <i class="fas fa-receipt" style="font-size: 2rem; color: #ccc; margin-bottom: 10px;"></i>
                      <p style="margin: 0; color: #666; font-size: 0.9rem;">No Receipt Available</p>
                    </div>
                  </ng-template>
                </div>
              </div>
            </div>

            <!-- Info Buttons Section -->
            <div class="info-buttons-section mt-4">
              <h6 class="section-title">
                <i class="fas fa-chart-bar"></i> Stock Information
              </h6>
              <div class="row">
                <!-- Availability Info -->
                <div class="col-md-4 mb-3">
                  <button class="btn btn-outline-info w-100 info-btn" (click)="showAvailabilityInfo()">
                    <i class="fas fa-boxes"></i>
                    <span>Availability</span>
                  </button>
                </div>

                <!-- Dispose Info -->
                <div class="col-md-4 mb-3">
                  <button class="btn btn-outline-warning w-100 info-btn" (click)="showDisposeInfo()">
                    <i class="fas fa-recycle"></i>
                    <span>Dispose Info</span>
                  </button>
                </div>

                <!-- In Use Components -->
                <div class="col-md-4 mb-3">
                  <button class="btn btn-outline-success w-100 info-btn" (click)="showInUseInfo()">
                    <i class="fas fa-desktop"></i>
                    <span>In Use Components</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Info Display Area -->
            <div class="info-display-area mt-3" *ngIf="currentInfoType">
              <div class="alert" [ngClass]="getInfoAlertClass()">
                <div class="info-header">
                  <i [class]="getInfoIcon()"></i>
                  <strong>{{ getInfoTitle() }}</strong>
                </div>
                <div class="info-content mt-2">
                  <div [innerHTML]="getInfoContent()"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Edit Stock Modal -->
<div class="modal-overlay" *ngIf="showEditStockModal" (click)="closeEditStockModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-title">
          <i class="fas fa-edit"></i>
          <div>
            <h1 class="page-title">Edit Stock Item</h1>
            <p class="page-subtitle">Update stock information</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-close" (click)="closeEditStockModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="modal-body">
      <!-- Edit Stock Form Content -->
      <div class="form-card">
        <div class="card">
          <div class="card-header">
            <h5><i class="fas fa-edit"></i> Stock Information</h5>
          </div>
          <div class="card-body">
            <form (ngSubmit)="saveEditStock()" #editStockForm="ngForm" class="stock-form">
              <div class="row">
                <!-- Item Selection (Read-only) -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-tag"></i> Item
                  </label>
                  <input type="text" class="form-control" [value]="getItemName(editStockModel.itemId)" readonly>
                </div>

                <!-- Storage Location -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-map-marker-alt"></i> Storage Location *
                  </label>
                  <select 
                    class="form-select" 
                    [(ngModel)]="editStockModel.locationId" 
                    name="locationId"
                    [class.is-invalid]="editStockSubmitted && !editStockModel.locationId"
                    required>
                    <option value="">Select Storage Location</option>
                    <option *ngFor="let location of locations" [value]="location.id">
                      {{ location.name }}
                    </option>
                  </select>
                  <div class="invalid-feedback" *ngIf="editStockSubmitted && !editStockModel.locationId">
                    Storage location is required
                  </div>
                </div>

                <!-- Quantity -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-sort-numeric-up"></i> Quantity *
                  </label>
                  <input 
                    type="number" 
                    class="form-control" 
                    [(ngModel)]="editStockModel.quantity" 
                    name="quantity"
                    (input)="onEditQuantityChange()"
                    [class.is-invalid]="editStockSubmitted && (!editStockModel.quantity || editStockModel.quantity <= 0)"
                    min="1"
                    required>
                  <div class="invalid-feedback" *ngIf="editStockSubmitted && (!editStockModel.quantity || editStockModel.quantity <= 0)">
                    Quantity must be greater than 0
                  </div>
                </div>

                <!-- Price -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-dollar-sign"></i> Price (per item) *
                  </label>
                  <input 
                    type="number" 
                    class="form-control" 
                    [(ngModel)]="editStockModel.price" 
                    name="price"
                    (input)="onEditPriceChange()"
                    [class.is-invalid]="editStockSubmitted && (!editStockModel.price || editStockModel.price <= 0)"
                    min="0.01"
                    step="0.01"
                    required>
                  <div class="invalid-feedback" *ngIf="editStockSubmitted && (!editStockModel.price || editStockModel.price <= 0)">
                    Price must be greater than 0
                  </div>
                </div>

                <!-- Total Price (Calculated) -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-calculator"></i> Total Price
                  </label>
                  <input 
                    type="text" 
                    class="form-control total-price" 
                    [value]="'php' + (editTotalPrice | number:'1.2-2')" 
                    readonly>
                </div>

                <!-- Remarks -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-comment"></i> Remarks
                  </label>
                  <textarea 
                    class="form-control" 
                    [(ngModel)]="editStockModel.remarks" 
                    name="remarks"
                    rows="3"
                    placeholder="Optional remarks about this stock entry"></textarea>
                </div>
              </div>

              <!-- Form Actions -->
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="closeEditStockModal()">
                  <i class="fas fa-times"></i> Cancel
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="editStockLoading">
                  <i class="fas fa-save" *ngIf="!editStockLoading"></i>
                  <span class="spinner-border spinner-border-sm" *ngIf="editStockLoading"></span>
                  {{ editStockLoading ? 'Saving...' : 'Save Changes' }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Receipt Modal -->
<div class="modal-overlay" *ngIf="showReceiptModal" (click)="closeReceiptModal()">
  <div class="modal-container receipt-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-title">
          <i class="fas fa-receipt"></i>
          <div>
            <h1 class="page-title">Receipt Photo</h1>
            <p class="page-subtitle">View receipt attachment</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-close" (click)="closeReceiptModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="modal-body">
      <div class="receipt-viewer">
        <div *ngIf="currentReceiptUrl; else noReceiptTemplate">
          <img 
            [src]="currentReceiptUrl" 
            alt="Receipt Photo" 
            class="receipt-full-image"
            style="max-width: 100%; max-height: 70vh; object-fit: contain; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.2);"
            (error)="onReceiptImageError($event)"
            (load)="onReceiptImageLoad($event)"
            onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
          >
          <div class="receipt-error-placeholder" style="display: none; text-align: center; padding: 40px;">
            <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: #ffc107; margin-bottom: 1rem;"></i>
            <h4>Receipt Image Not Found</h4>
            <p class="text-muted">The receipt file "{{ selectedStock?.receiptAttachment }}" could not be loaded.</p>
            <p class="text-muted"><small>This may be due to the file being moved or deleted from the server.</small></p>
          </div>
        </div>
        <ng-template #noReceiptTemplate>
          <div class="no-receipt-placeholder">
            <i class="fas fa-receipt" style="font-size: 4rem; color: #ccc; margin-bottom: 1rem;"></i>
            <h4>No Receipt Available</h4>
            <p class="text-muted">This stock entry doesn't have a receipt photo attached.</p>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<!-- Delete Stock Confirmation Modal -->
<div class="modal fade" 
     [class.show]="showDeleteStockModal" 
     [style.display]="showDeleteStockModal ? 'block' : 'none'"
     tabindex="-1" 
     role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">
          <i class="fas fa-exclamation-triangle text-danger"></i>
          Confirm Delete
        </h4>
        <button type="button" class="btn-close" (click)="cancelDeleteStock()"></button>
      </div>
      
      <div class="modal-body">
        <div class="alert alert-danger">
          <i class="fas fa-warning"></i>
          <strong>Warning:</strong> This action cannot be undone!
        </div>
        
        <p class="lead">Are you sure you want to delete this stock entry?</p>
        
        <div class="stock-details" *ngIf="stockToDelete">
          <table class="table table-striped">
            <tr>
              <th>Item:</th>
              <td>{{ getItemName(stockToDelete.itemId) }}</td>
            </tr>
            <tr>
              <th>Quantity:</th>
              <td>{{ stockToDelete.quantity }}</td>
            </tr>
            <tr>
              <th>Price:</th>
              <td>₱{{ stockToDelete.price | number:'1.2-2' }}</td>
            </tr>
            <tr>
              <th>Total Value:</th>
              <td class="text-danger font-weight-bold">₱{{ (stockToDelete.quantity * stockToDelete.price) | number:'1.2-2' }}</td>
            </tr>
            <tr>
              <th>Location:</th>
              <td>{{ getLocationName(stockToDelete.locationId) }}</td>
            </tr>
          </table>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" 
                class="btn btn-secondary" 
                (click)="cancelDeleteStock()">
          <i class="fas fa-times"></i> Cancel
        </button>
        <button type="button" 
                class="btn btn-danger" 
                (click)="deleteStock()"
                [disabled]="deleteStockLoading">
          <i class="fas fa-trash"></i> 
          <span *ngIf="!deleteStockLoading">Delete Stock Entry</span>
          <span *ngIf="deleteStockLoading">Deleting...</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal backdrop -->
<div class="modal-backdrop fade" 
     [class.show]="showDeleteStockModal" 
     *ngIf="showDeleteStockModal">
</div>
