<div class="list-container">
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-content">
        <div class="header-title">
          <i class="fas fa-boxes"></i>
          <div>
            <h1 class="page-title">Stock Management</h1>
            <p class="page-subtitle">Manage and track your inventory stock levels</p>
          </div>
        </div>
        <div class="header-actions">
          <a routerLink="/dispose" class="btn btn-info" *ngIf="hasRole([Role.SuperAdmin, Role.Admin, Role.Staff, Role.Viewer])">
            <i class="fas fa-trash-alt"></i>
            View Disposals
          </a>
          <a routerLink="/pc" class="btn btn-secondary">
            <i class="fas fa-desktop"></i> View PCs
          </a>
          <button class="btn btn-primary" (click)="openAddStockModal()">
            <i class="fas fa-plus"></i>
            Add Stock
          </button>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-boxes"></i>
        </div>
        <div class="stat-number">{{ stocks.length }}</div>
        <div class="stat-label">Total Stock Entries</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-plus-circle"></i>
        </div>
        <div class="stat-number">{{ getAdditionsCount() }}</div>
        <div class="stat-label">Stock Additions</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-minus-circle"></i>
        </div>
        <div class="stat-number">{{ getDisposalsCount() }}</div>
        <div class="stat-label">Stock Disposals</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-undo"></i>
        </div>
        <div class="stat-number">{{ getReturnedDisposalsCount() }}</div>
        <div class="stat-label">Returned to Stock</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="stat-number">php{{ getTotalValue() | number:'1.0-0' }}</div>
        <div class="stat-label">Total Value</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">
          <i class="fas fa-desktop"></i>
        </div>
        <div class="stat-number">{{ getPCComponentsCount() }}</div>
        <div class="stat-label">PC Components</div>
      </div>
    </div>

    <!-- Filters and Search -->
    <div class="filters-section">
      <div class="row">
        <div class="col-md-6">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input 
              type="text" 
              class="form-control" 
              placeholder="Search stocks..."
              [(ngModel)]="searchTerm"
              (input)="onSearch()"
            >
          </div>
        </div>
        <div class="col-md-6">
          <div class="filter-controls">
            <select class="form-select" [(ngModel)]="selectedCategory" (change)="onFilterChange()">
              <option value="">All Categories</option>
              <option *ngFor="let category of categories" [value]="category.id">
                {{ category.name }}
              </option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Stock Table -->
    <div class="card">
      <div class="card-header">
        <h5><i class="fas fa-list"></i> Stock Entries</h5>
        <div class="table-actions">
          <button class="btn btn-sm btn-outline-secondary" (click)="refreshData()">
            <i class="fas fa-sync-alt"></i>
            Refresh
          </button>
        </div>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th><i class="fas fa-box"></i> Item</th>
                <th><i class="fas fa-tag"></i> Category</th>
                <th><i class="fas fa-trademark"></i> Brand</th>
                <th><i class="fas fa-map-marker-alt"></i> Location</th>
                <th><i class="fas fa-sort-numeric-up"></i> Quantity</th>
                <th><i class="fas fa-dollar-sign"></i> Price</th>
                <th><i class="fas fa-calculator"></i> Total</th>
                <th><i class="fas fa-clock"></i> Time & Date</th>
                <th><i class="fas fa-user"></i> Created By</th>
                <th><i class="fas fa-desktop"></i> In Use</th>
                <th><i class="fas fa-cogs"></i> Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let stock of paginatedStocks" [attr.data-item-id]="stock.itemId" class="stock-row">
                <td data-label="Item">
                  <div class="item-info">
                    <strong>{{ stock.item?.name || getItemName(stock.itemId) }}</strong>
                    <small class="d-block text-muted" *ngIf="stock.item?.description">
                      {{ stock.item.description }}
                    </small>
                    <small class="d-block text-muted" *ngIf="stock.disposal">
                      <strong>Disposal Info:</strong><br>
                      Reason: {{ stock.disposal.reason || 'No reason' }}<br>
                      Date: {{ stock.disposal.disposalDate | date:'MMM dd, yyyy' }}<br>
                      <span *ngIf="stock.disposal.returnedToStock" class="text-success">
                        <i class="fas fa-check-circle"></i> Returned to Stock
                      </span>
                    </small>
                    <small class="d-block text-muted" *ngIf="stock.remarks && !stock.disposal">
                      {{ stock.remarks }}
                    </small>
                  </div>
                </td>
                <td data-label="Category">
                  <span class="category-badge">
                    {{ stock.item?.category?.name || getCategoryName(stock) }}
                  </span>
                </td>
                <td data-label="Brand">
                  <span class="brand-badge">
                    {{ stock.item?.brand?.name || getBrandName(stock) }}
                  </span>
                </td>
                <td data-label="Location">
                  <span class="location-badge">
                    {{ stock.location?.name || getLocationName(stock) }}
                    <small class="d-block text-muted" *ngIf="stock.location?.description">
                      {{ stock.location.description }}
                    </small>
                  </span>
                </td>
                <td data-label="Quantity">
                  <div class="quantity-info">
                    <span class="quantity-badge" [ngClass]="{
                      'quantity-positive': isItemEffectivelyAvailable(stock) && stock.quantity > 0,
                      'quantity-negative': stock.disposeId && !stock.disposal?.returnedToStock,
                      'quantity-zero': stock.quantity === 0
                    }">
                      {{ stock.quantity }}
                    </span>
                    <div class="stock-summary" *ngIf="isItemEffectivelyAvailable(stock)">
                      <strong>Stock Summary:</strong><br>
                      Total: {{ getStockSummary(stock.itemId).total }} | 
                      Available: {{ getStockSummary(stock.itemId).available }} | 
                      In Use: {{ getStockSummary(stock.itemId).inUse }}
                    </div>
                    <small class="d-block text-muted mt-1" *ngIf="stock.disposeId && stock.disposal && stock.disposal.returnedToStock">
                      <span class="badge badge-success">
                        <i class="fas fa-undo"></i> Returned {{ stock.quantity }} from disposal
                      </span>
                    </small>
                    <small class="d-block text-muted mt-1" *ngIf="stock.disposal && !stock.disposal.returnedToStock">
                      <strong>Disposal Value:</strong> php{{ stock.disposal.disposalValue | number:'1.2-2' }}<br>
                      <strong>Total Value:</strong> php{{ (stock.disposal.disposalValue * stock.quantity) | number:'1.2-2' }}
                    </small>
                  </div>
                </td>
                <td data-label="Price">
                  <span class="price-value">
                    php{{ stock.price | number:'1.2-2' }}
                  </span>
                </td>
                <td data-label="Total">
                  <span class="total-price">
                    php{{ (stock.price * stock.quantity) | number:'1.2-2' }}
                  </span>
                </td>
                <td data-label="Time & Date">
                  <div class="time-date-info">
                    <span class="date-badge">
                      {{ stock.createdAt | date:'MMM dd, yyyy' }}
                    </span>
                    <small class="d-block text-muted mt-1">
                      {{ stock.createdAt | date:'HH:mm:ss' }}
                    </small>
                    <small class="d-block text-muted" *ngIf="stock.disposeId && stock.disposal && !stock.disposal.returnedToStock">
                      <span class="badge badge-danger">
                        <i class="fas fa-trash-alt"></i> Disposal
                      </span>
                    </small>
                  </div>
                </td>
                <td data-label="Created By">
                  <div class="user-info">
                    <span class="user-badge" *ngIf="stock.user">
                      {{ stock.user.firstName }} {{ stock.user.lastName }}
                    </span>
                    <span class="user-badge text-muted" *ngIf="!stock.user">
                      Unknown User
                    </span>
                    <small class="d-block text-muted mt-1" *ngIf="stock.user?.email">
                      {{ stock.user.email }}
                    </small>
                  </div>
                </td>
                <td data-label="In Use">
                  <div class="in-use-info">
                    <span *ngIf="isItemInUse(stock.itemId)" class="badge badge-warning">
                      <i class="fas fa-desktop"></i> In Use
                    </span>
                    <span *ngIf="!isItemInUse(stock.itemId)" class="badge badge-secondary">
                      <i class="fas fa-box"></i> Available
                    </span>
                    <small class="d-block text-muted mt-1">
                      {{ getInUseDetails(stock.itemId) }}
                    </small>
                  </div>
                </td>
                <td data-label="Actions">
                  <div class="action-buttons">
                    <button type="button" class="btn btn-sm btn-outline-primary"
                            (click)="openViewStockModal(stock)" title="View Details">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-warning"
                            (click)="openEditStockModal(stock)" title="Edit Stock"
                            *ngIf="hasRole([Role.SuperAdmin, Role.Admin, Role.Staff])">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-info"
                            (click)="navigateToDispose(stock)" title="Dispose Stock"
                            *ngIf="isItemEffectivelyAvailable(stock) && hasRole([Role.SuperAdmin, Role.Admin, Role.Staff])">
                      <i class="fas fa-recycle"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filteredStocks.length === 0">
                <td colspan="10" class="text-center py-4">
                  <div class="empty-state">
                    <i class="fas fa-box-open"></i>
                    <h4>No stock entries found</h4>
                    <p>Try adjusting your search or filters</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-section" *ngIf="filteredStocks.length > 0">
      <div class="pagination-info">
        Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, filteredStocks.length) }} of {{ filteredStocks.length }} entries
      </div>
      <nav aria-label="Stock pagination">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="previousPage()">
              <i class="fas fa-chevron-left"></i>
            </a>
          </li>
          <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage">
            <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="nextPage()">
              <i class="fas fa-chevron-right"></i>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<!-- Add Stock Modal -->
<div class="modal-overlay" *ngIf="showAddStockModal" (click)="closeAddStockModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-title">
          <i class="fas fa-plus-circle"></i>
          <div>
            <h1 class="page-title">Add New Item</h1>
            <p class="page-subtitle">Create a new inventory item</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-close" (click)="closeAddStockModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="modal-body">
      <!-- Add Stock Form Content -->
      <div class="form-card">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5><i class="fas fa-edit"></i> Stock Information</h5>
            <button type="button" class="btn btn-success btn-sm" (click)="addNewStockEntry()">
              <i class="fas fa-plus"></i> Add New Item
            </button>
          </div>
          <div class="card-body">
            <form (ngSubmit)="saveStock()" #stockForm="ngForm" class="stock-form">
              
              <!-- Multiple Stock Entries -->
              <div *ngFor="let entry of stockEntries; let i = index" class="stock-entry mb-4 p-3 border rounded">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h6 class="mb-0">
                    <i class="fas fa-box"></i> Stock Entry {{ i + 1 }}
                  </h6>
                  <button 
                    type="button" 
                    class="btn btn-outline-danger btn-sm" 
                    (click)="removeStockEntry(i)"
                    *ngIf="stockEntries.length > 1"
                    title="Remove this entry"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>

                <div class="row">
                  <!-- Item Selection -->
                  <div class="form-group col-md-6">
                    <label class="form-label">
                      <i class="fas fa-tag"></i> Item *
                    </label>
                    <select 
                      class="form-select" 
                      [(ngModel)]="entry.itemId" 
                      [name]="'itemId_' + i" 
                      required 
                      [ngClass]="{ 'is-invalid': stockSubmitted && !entry.itemId }"
                      (change)="calculateTotalPrice()"
                    >
                      <option value="" disabled>Select Item</option>
                      <option *ngFor="let item of items" [value]="item.id">
                        {{ item.name }} ({{ item.category?.name || 'No Category' }})
                      </option>
                    </select>
                    <div class="invalid-feedback" *ngIf="stockSubmitted && !entry.itemId">
                      Please select an item
                    </div>
                  </div>

                  <!-- Quantity -->
                  <div class="form-group col-md-6">
                    <label class="form-label">
                      <i class="fas fa-sort-numeric-up"></i> Quantity *
                    </label>
                    <input 
                      type="number" 
                      class="form-control" 
                      [(ngModel)]="entry.quantity" 
                      [name]="'quantity_' + i" 
                      required
                      min="1"
                      (input)="calculateTotalPrice()"
                      [ngClass]="{ 'is-invalid': stockSubmitted && (!entry.quantity || entry.quantity <= 0) }"
                      placeholder="Enter quantity"
                    >
                    <div class="invalid-feedback" *ngIf="stockSubmitted && (!entry.quantity || entry.quantity <= 0)">
                      Quantity must be greater than 0
                    </div>
                  </div>
                </div>

                <div class="row">
                  <!-- Price -->
                  <div class="form-group col-md-6">
                    <label class="form-label">
                      <i class="fas fa-dollar-sign"></i> Price (per item) *
                    </label>
                    <input 
                      type="number" 
                      class="form-control" 
                      [(ngModel)]="entry.price" 
                      [name]="'price_' + i" 
                      step="0.01"
                      required
                      (input)="calculateTotalPrice()"
                      [ngClass]="{ 'is-invalid': stockSubmitted && (!entry.price || entry.price <= 0) }"
                      placeholder="Enter price"
                    >
                    <div class="invalid-feedback" *ngIf="stockSubmitted && (!entry.price || entry.price <= 0)">
                      Price must be greater than 0
                    </div>
                  </div>

                  <!-- Storage Location -->
                  <div class="form-group col-md-6">
                    <label class="form-label">
                      <i class="fas fa-map-marker-alt"></i> Storage Location *
                    </label>
                    <select 
                      class="form-select" 
                      [(ngModel)]="entry.locationId" 
                      [name]="'locationId_' + i" 
                      required
                      [ngClass]="{ 'is-invalid': stockSubmitted && !entry.locationId }"
                    >
                      <option value="" disabled>Select Location</option>
                      <option *ngFor="let location of locations" [value]="location.id">
                        {{ location.name }}
                      </option>
                    </select>
                    <div class="invalid-feedback" *ngIf="stockSubmitted && !entry.locationId">
                      Please select a storage location
                    </div>
                  </div>
                </div>

                <div class="row">
                  <!-- Remarks -->
                  <div class="form-group col-md-6">
                    <label class="form-label">
                      <i class="fas fa-comment"></i> Remarks
                    </label>
                    <input 
                      type="text" 
                      class="form-control" 
                      [(ngModel)]="entry.remarks" 
                      [name]="'remarks_' + i" 
                      placeholder="Optional remarks"
                    >
                  </div>

                  <!-- Receipt Upload -->
                  <div class="form-group col-md-6">
                    <label class="form-label">
                      <i class="fas fa-receipt"></i> Receipt Photo (Optional)
                    </label>
                    <input 
                      type="file" 
                      class="form-control" 
                      accept="image/*"
                      (change)="onFileSelected($event, i)"
                      [name]="'receipt_' + i"
                    >
                    <small class="form-text text-muted">
                      Upload receipt photo (JPG, PNG, GIF - Max 5MB)
                    </small>
                  </div>
                </div>
              </div>

              <!-- Total Price Summary -->
              <div class="row mb-3">
                <div class="col-md-12">
                  <div class="alert alert-info">
                    <div class="d-flex justify-content-between align-items-center">
                      <span><i class="fas fa-calculator"></i> <strong>Total Price for All Items:</strong></span>
                      <span class="h5 mb-0">₱{{ totalPrice | number:'1.2-2' }}</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Form Actions -->
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="closeAddStockModal()">
                  <i class="fas fa-times"></i>
                  Cancel
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="stockLoading">
                  <i class="fas fa-save"></i>
                  <span *ngIf="!stockLoading">Add {{ stockEntries.length }} Stock Item(s)</span>
                  <span *ngIf="stockLoading">Adding...</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- View Stock Modal -->
<div class="modal-overlay" *ngIf="showViewStockModal" (click)="closeViewStockModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-title">
          <i class="fas fa-eye"></i>
          <div>
            <h1 class="page-title">Stock Details</h1>
            <p class="page-subtitle">View detailed stock information</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-close" (click)="closeViewStockModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="modal-body">
      <div class="form-card">
        <div class="card">
          <div class="card-header">
            <h5><i class="fas fa-info-circle"></i> Stock Information</h5>
          </div>
          <div class="card-body">
            <div *ngIf="selectedStock">
              <!-- Enhanced Stock Details Grid -->
              <div class="stock-details-grid">
                <!-- Stock ID -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-hashtag"></i> Stock ID
                  </div>
                  <div class="detail-value highlight">{{ selectedStock.id }}</div>
                </div>

                <!-- Stock Name -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-box"></i> Stock Name
                  </div>
                  <div class="detail-value">{{ getItemName(selectedStock.itemId) }}</div>
                </div>

                <!-- Brand -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-trademark"></i> Brand
                  </div>
                  <div class="detail-value">{{ getBrandName(selectedStock) }}</div>
                </div>

                <!-- Category -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-tag"></i> Category
                  </div>
                  <div class="detail-value">{{ getCategoryName(selectedStock) }}</div>
                </div>

                <!-- Date Added -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-calendar-alt"></i> Date Added
                  </div>
                  <div class="detail-value">{{ selectedStock.createdAt | date:'MMM dd, yyyy' }}</div>
                </div>

                <!-- Time Added -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-clock"></i> Time Added
                  </div>
                  <div class="detail-value">{{ selectedStock.createdAt | date:'HH:mm:ss' }}</div>
                </div>

                <!-- Storage Location -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-map-marker-alt"></i> Storage Location
                  </div>
                  <div class="detail-value">{{ getLocationName(selectedStock) }}</div>
                </div>

                <!-- Quantity -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-sort-numeric-up"></i> Quantity
                  </div>
                  <div class="detail-value" [ngClass]="selectedStock.quantity > 0 ? 'success' : 'danger'">
                    {{ selectedStock.quantity }} units
                  </div>
                </div>

                <!-- Price -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-dollar-sign"></i> Price (per item)
                  </div>
                  <div class="detail-value warning">₱{{ selectedStock.price | number:'1.2-2' }}</div>
                </div>

                <!-- Total Value -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-calculator"></i> Total Value
                  </div>
                  <div class="detail-value highlight">₱{{ (selectedStock.quantity * selectedStock.price) | number:'1.2-2' }}</div>
                </div>
              </div>

              <!-- Remarks Section -->
              <div class="detail-item" *ngIf="selectedStock.remarks">
                <div class="detail-label">
                  <i class="fas fa-comment"></i> Remarks
                </div>
                <div class="detail-value">{{ selectedStock.remarks }}</div>
              </div>

              <!-- Receipt Section -->
              <div class="detail-item" *ngIf="selectedStock.receiptAttachment">
                <div class="detail-label">
                  <i class="fas fa-receipt"></i> Receipt Photo
                </div>
                <div class="detail-value">
                  <div class="receipt-container">
                    <img 
                      [src]="getReceiptUrl(selectedStock.receiptAttachment)" 
                      alt="Receipt Photo" 
                      class="receipt-image"
                      (click)="openReceiptModal(selectedStock.receiptAttachment)"
                      style="cursor: pointer; max-width: 200px; max-height: 150px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);"
                    >
                    <div class="receipt-actions mt-2">
                      <button class="btn btn-sm btn-outline-primary" (click)="openReceiptModal(selectedStock.receiptAttachment)">
                        <i class="fas fa-expand"></i> View Full Size
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Info Buttons Section -->
            <div class="info-buttons-section mt-4">
              <h6 class="section-title">
                <i class="fas fa-chart-bar"></i> Stock Information
              </h6>
              <div class="row">
                <!-- Availability Info -->
                <div class="col-md-4 mb-3">
                  <button class="btn btn-outline-info w-100 info-btn" (click)="showAvailabilityInfo()">
                    <i class="fas fa-boxes"></i>
                    <span>Availability</span>
                  </button>
                </div>

                <!-- Dispose Info -->
                <div class="col-md-4 mb-3">
                  <button class="btn btn-outline-warning w-100 info-btn" (click)="showDisposeInfo()">
                    <i class="fas fa-recycle"></i>
                    <span>Dispose Info</span>
                  </button>
                </div>

                <!-- In Use Components -->
                <div class="col-md-4 mb-3">
                  <button class="btn btn-outline-success w-100 info-btn" (click)="showInUseInfo()">
                    <i class="fas fa-desktop"></i>
                    <span>In Use Components</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Info Display Area -->
            <div class="info-display-area mt-3" *ngIf="currentInfoType">
              <div class="alert" [ngClass]="getInfoAlertClass()">
                <div class="info-header">
                  <i [class]="getInfoIcon()"></i>
                  <strong>{{ getInfoTitle() }}</strong>
                </div>
                <div class="info-content mt-2">
                  <div [innerHTML]="getInfoContent()"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Edit Stock Modal -->
<div class="modal-overlay" *ngIf="showEditStockModal" (click)="closeEditStockModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-title">
          <i class="fas fa-edit"></i>
          <div>
            <h1 class="page-title">Edit Stock Item</h1>
            <p class="page-subtitle">Update stock information</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-close" (click)="closeEditStockModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="modal-body">
      <!-- Edit Stock Form Content -->
      <div class="form-card">
        <div class="card">
          <div class="card-header">
            <h5><i class="fas fa-edit"></i> Stock Information</h5>
          </div>
          <div class="card-body">
            <form (ngSubmit)="saveEditStock()" #editStockForm="ngForm" class="stock-form">
              <div class="row">
                <!-- Item Selection (Read-only) -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-tag"></i> Item
                  </label>
                  <input type="text" class="form-control" [value]="getItemName(editStockModel.itemId)" readonly>
                </div>

                <!-- Storage Location -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-map-marker-alt"></i> Storage Location *
                  </label>
                  <select 
                    class="form-select" 
                    [(ngModel)]="editStockModel.locationId" 
                    name="locationId"
                    [class.is-invalid]="editStockSubmitted && !editStockModel.locationId"
                    required>
                    <option value="">Select Storage Location</option>
                    <option *ngFor="let location of locations" [value]="location.id">
                      {{ location.name }}
                    </option>
                  </select>
                  <div class="invalid-feedback" *ngIf="editStockSubmitted && !editStockModel.locationId">
                    Storage location is required
                  </div>
                </div>

                <!-- Quantity -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-sort-numeric-up"></i> Quantity *
                  </label>
                  <input 
                    type="number" 
                    class="form-control" 
                    [(ngModel)]="editStockModel.quantity" 
                    name="quantity"
                    (input)="onEditQuantityChange()"
                    [class.is-invalid]="editStockSubmitted && (!editStockModel.quantity || editStockModel.quantity <= 0)"
                    min="1"
                    required>
                  <div class="invalid-feedback" *ngIf="editStockSubmitted && (!editStockModel.quantity || editStockModel.quantity <= 0)">
                    Quantity must be greater than 0
                  </div>
                </div>

                <!-- Price -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-dollar-sign"></i> Price (per item) *
                  </label>
                  <input 
                    type="number" 
                    class="form-control" 
                    [(ngModel)]="editStockModel.price" 
                    name="price"
                    (input)="onEditPriceChange()"
                    [class.is-invalid]="editStockSubmitted && (!editStockModel.price || editStockModel.price <= 0)"
                    min="0.01"
                    step="0.01"
                    required>
                  <div class="invalid-feedback" *ngIf="editStockSubmitted && (!editStockModel.price || editStockModel.price <= 0)">
                    Price must be greater than 0
                  </div>
                </div>

                <!-- Total Price (Calculated) -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-calculator"></i> Total Price
                  </label>
                  <input 
                    type="text" 
                    class="form-control total-price" 
                    [value]="'php' + (editTotalPrice | number:'1.2-2')" 
                    readonly>
                </div>

                <!-- Remarks -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-comment"></i> Remarks
                  </label>
                  <textarea 
                    class="form-control" 
                    [(ngModel)]="editStockModel.remarks" 
                    name="remarks"
                    rows="3"
                    placeholder="Optional remarks about this stock entry"></textarea>
                </div>
              </div>

              <!-- Form Actions -->
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="closeEditStockModal()">
                  <i class="fas fa-times"></i> Cancel
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="editStockLoading">
                  <i class="fas fa-save" *ngIf="!editStockLoading"></i>
                  <span class="spinner-border spinner-border-sm" *ngIf="editStockLoading"></span>
                  {{ editStockLoading ? 'Saving...' : 'Save Changes' }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Receipt Modal -->
<div class="modal-overlay" *ngIf="showReceiptModal" (click)="closeReceiptModal()">
  <div class="modal-container receipt-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-title">
          <i class="fas fa-receipt"></i>
          <div>
            <h1 class="page-title">Receipt Photo</h1>
            <p class="page-subtitle">View receipt attachment</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-close" (click)="closeReceiptModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="modal-body">
      <div class="receipt-viewer">
        <img 
          [src]="currentReceiptUrl" 
          alt="Receipt Photo" 
          class="receipt-full-image"
          style="max-width: 100%; max-height: 70vh; object-fit: contain; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.2);"
        >
      </div>
    </div>
  </div>
</div>
