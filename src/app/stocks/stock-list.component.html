<div class="list-container">
  <div class="container">
    <!-- Stock List Content -->
    <div class="stock-list-content">
      <!-- Header -->
      <div class="header-section mb-4">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h1 class="main-title">
              <i class="fas fa-boxes text-primary me-3"></i>
              Stock Management
            </h1>
            <p class="subtitle text-muted">
              Manage and monitor your inventory stock levels
            </p>
          </div>
          <div class="header-actions">
            <button class="btn btn-primary" routerLink="/add">
              <i class="fas fa-plus me-2"></i>Add Stock
            </button>
          </div>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="stats-grid mb-4">
        <div class="stat-card" *ngFor="let stat of stockStats">
          <div class="stat-icon">
            <i [class]="stat.icon"></i>
          </div>
          <div class="stat-content">
            <div class="stat-number">{{stat.value}}</div>
            <div class="stat-label">{{stat.label}}</div>
          </div>
        </div>
      </div>

      <!-- Filters -->
      <div class="filters-section mb-4">
        <div class="row">
          <div class="col-md-3 mb-3">
            <label class="form-label">Category</label>
            <select class="form-select" [(ngModel)]="selectedCategory" (change)="filterStocks()">
              <option value="">All Categories</option>
              <option *ngFor="let category of categories" [value]="category.id">
                {{category.name}}
              </option>
            </select>
          </div>
          <div class="col-md-3 mb-3">
            <label class="form-label">Brand</label>
            <select class="form-select" [(ngModel)]="selectedBrand" (change)="filterStocks()">
              <option value="">All Brands</option>
              <option *ngFor="let brand of brands" [value]="brand.id">
                {{brand.name}}
              </option>
            </select>
          </div>
          <div class="col-md-3 mb-3">
            <label class="form-label">Status</label>
            <select class="form-select" [(ngModel)]="selectedStatus" (change)="filterStocks()">
              <option value="">All Status</option>
              <option value="available">Available</option>
              <option value="in-use">In Use</option>
              <option value="disposed">Disposed</option>
            </select>
          </div>
          <div class="col-md-3 mb-3">
            <label class="form-label">&nbsp;</label>
            <button class="btn btn-outline-secondary w-100" (click)="clearFilters()">
              <i class="fas fa-times me-2"></i>Clear Filters
            </button>
          </div>
        </div>
      </div>

      <!-- Stock Table -->
      <div class="stock-table-container">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Item</th>
                <th>Category</th>
                <th>Brand</th>
                <th>Location</th>
                <th>Quantity</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let stock of filteredStocks">
                <td>
                  <div class="item-info">
                    <div class="item-name">{{stock.item?.name}}</div>
                    <div class="item-description">{{stock.item?.description}}</div>
                  </div>
                </td>
                <td>
                  <span class="category-badge">{{stock.item?.category?.name}}</span>
                </td>
                <td>
                  <span class="brand-badge">{{stock.item?.brand?.name}}</span>
                </td>
                <td>
                  <span class="location-badge">{{stock.storageLocation?.name}}</span>
                </td>
                <td>
                  <div class="quantity-info">
                    <span class="quantity-badge">{{stock.quantity}}</span>
                    <div class="stock-summary" *ngIf="!stock.disposeId">
                      <small class="text-muted">
                        Total: {{stock.quantity}} | 
                        Available: {{stock.quantity - (stock.inUse || 0)}} | 
                        In Use: {{stock.inUse || 0}}
                      </small>
                    </div>
                    <div class="disposal-info" *ngIf="stock.disposeId">
                      <small class="text-danger">
                        Disposed: {{stock.disposal?.quantity}} | 
                        Reason: {{stock.disposal?.reason}}
                      </small>
                      <small class="badge badge-success" *ngIf="stock.disposal?.returnedToStock">
                        Returned
                      </small>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="status-info">
                    <span class="status-badge" [ngClass]="getStatusClass(stock)">
                      {{getStatusText(stock)}}
                    </span>
                    <div class="in-use-info" *ngIf="stock.inUse > 0">
                      <small class="badge badge-info">{{stock.inUse}} in use</small>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="btn btn-sm btn-outline-primary me-1" (click)="viewStock(stock)">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-warning me-1" (click)="editStock(stock)" *ngIf="!stock.disposeId">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" (click)="disposeStock(stock)" *ngIf="!stock.disposeId">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Stock Modal -->
<div class="modal-overlay" *ngIf="showAddStockModal" (click)="closeAddStockModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-title">
          <i class="fas fa-plus-circle"></i>
          <div>
            <h1 class="page-title">Add New Item</h1>
            <p class="page-subtitle">Create a new inventory item</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-close" (click)="closeAddStockModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="modal-body">
      <!-- Add Stock Form Content -->
      <div class="form-card">
        <div class="card">
          <div class="card-header">
            <h5><i class="fas fa-edit"></i> Stock Information</h5>
          </div>
          <div class="card-body">
            <form (ngSubmit)="saveStock()" #stockForm="ngForm" class="stock-form">
              <div class="row">
                <!-- Item Selection -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-tag"></i> Item *
                  </label>
                  <select 
                    class="form-select" 
                    [(ngModel)]="stockModel.itemId" 
                    name="itemId" 
                    required 
                    [ngClass]="{ 'is-invalid': stockSubmitted && !stockModel.itemId }"
                    (change)="onItemChange()"
                  >
                    <option value="" disabled>Select Item</option>
                    <option *ngFor="let item of items" [value]="item.id">
                      {{ item.name }} ({{ item.category?.name || 'No Category' }})
                    </option>
                  </select>
                  <div class="invalid-feedback" *ngIf="stockSubmitted && !stockModel.itemId">
                    Please select an item
                  </div>
                </div>

                <!-- Quantity -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-sort-numeric-up"></i> Quantity *
                  </label>
                  <input 
                    type="number" 
                    class="form-control" 
                    [(ngModel)]="stockModel.quantity" 
                    name="quantity" 
                    required
                    min="1"
                    (input)="onQuantityChange()"
                    [ngClass]="{ 'is-invalid': stockSubmitted && (!stockModel.quantity || stockModel.quantity <= 0) }"
                    placeholder="Enter quantity"
                  >
                  <div class="invalid-feedback" *ngIf="stockSubmitted && (!stockModel.quantity || stockModel.quantity <= 0)">
                    Quantity must be greater than 0
                  </div>
                </div>
              </div>

              <div class="row">
                <!-- Price -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-dollar-sign"></i> Price (per item) *
                  </label>
                  <input 
                    type="number" 
                    class="form-control" 
                    [(ngModel)]="stockModel.price" 
                    name="price" 
                    step="0.01"
                    required
                    (input)="calculateTotalPrice()"
                    [ngClass]="{ 'is-invalid': stockSubmitted && (!stockModel.price || stockModel.price <= 0) }"
                    placeholder="Enter price"
                  >
                  <div class="invalid-feedback" *ngIf="stockSubmitted && (!stockModel.price || stockModel.price <= 0)">
                    Price must be greater than 0
                  </div>
                </div>

                <!-- Total Price (Read-only) -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-calculator"></i> Total Price
                  </label>
                  <input 
                    type="text" 
                    class="form-control" 
                    [value]="'php' + (totalPrice | number:'1.2-2')" 
                    readonly
                    style="background-color: #f8f9fa;"
                  >
                </div>
              </div>

              <div class="row">
                <!-- Storage Location -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-map-marker-alt"></i> Storage Location *
                  </label>
                  <select 
                    class="form-select" 
                    [(ngModel)]="stockModel.locationId" 
                    name="locationId" 
                    required
                    [ngClass]="{ 'is-invalid': stockSubmitted && !stockModel.locationId }"
                  >
                    <option value="" disabled>Select Location</option>
                    <option *ngFor="let location of locations" [value]="location.id">
                      {{ location.name }}
                    </option>
                  </select>
                  <div class="invalid-feedback" *ngIf="stockSubmitted && !stockModel.locationId">
                    Please select a storage location
                  </div>
                </div>

                <!-- Remarks -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-comment"></i> Remarks
                  </label>
                  <input 
                    type="text" 
                    class="form-control" 
                    [(ngModel)]="stockModel.remarks" 
                    name="remarks" 
                    placeholder="Optional remarks"
                  >
                </div>
              </div>

              <!-- Form Actions -->
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="closeAddStockModal()">
                  <i class="fas fa-times"></i>
                  Cancel
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="stockLoading">
                  <i class="fas fa-save"></i>
                  <span *ngIf="!stockLoading">Add Stock</span>
                  <span *ngIf="stockLoading">Adding...</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- View Stock Modal -->
<div class="modal-overlay" *ngIf="showViewStockModal" (click)="closeViewStockModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-title">
          <i class="fas fa-eye"></i>
          <div>
            <h1 class="page-title">Stock Details</h1>
            <p class="page-subtitle">View detailed stock information</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-close" (click)="closeViewStockModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="modal-body">
      <div class="form-card">
        <div class="card">
          <div class="card-header">
            <h5><i class="fas fa-info-circle"></i> Stock Information</h5>
          </div>
          <div class="card-body">
            <div *ngIf="selectedStock">
              <!-- Enhanced Stock Details Grid -->
              <div class="stock-details-grid">
                <!-- Stock ID -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-hashtag"></i> Stock ID
                  </div>
                  <div class="detail-value highlight">{{ selectedStock.id }}</div>
                </div>

                <!-- Stock Name -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-box"></i> Stock Name
                  </div>
                  <div class="detail-value">{{ getItemName(selectedStock.itemId) }}</div>
                </div>

                <!-- Brand -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-trademark"></i> Brand
                  </div>
                  <div class="detail-value">{{ getBrandName(selectedStock) }}</div>
                </div>

                <!-- Category -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-tag"></i> Category
                  </div>
                  <div class="detail-value">{{ getCategoryName(selectedStock) }}</div>
                </div>

                <!-- Date Added -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-calendar-alt"></i> Date Added
                  </div>
                  <div class="detail-value">{{ selectedStock.createdAt | date:'MMM dd, yyyy' }}</div>
                </div>

                <!-- Time Added -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-clock"></i> Time Added
                  </div>
                  <div class="detail-value">{{ selectedStock.createdAt | date:'HH:mm:ss' }}</div>
                </div>

                <!-- Storage Location -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-map-marker-alt"></i> Storage Location
                  </div>
                  <div class="detail-value">{{ getLocationName(selectedStock) }}</div>
                </div>

                <!-- Quantity -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-sort-numeric-up"></i> Quantity
                  </div>
                  <div class="detail-value" [ngClass]="selectedStock.quantity > 0 ? 'success' : 'danger'">
                    {{ selectedStock.quantity }} units
                  </div>
                </div>

                <!-- Price -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-dollar-sign"></i> Price (per item)
                  </div>
                  <div class="detail-value warning">₱{{ selectedStock.price | number:'1.2-2' }}</div>
                </div>

                <!-- Total Value -->
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="fas fa-calculator"></i> Total Value
                  </div>
                  <div class="detail-value highlight">₱{{ (selectedStock.quantity * selectedStock.price) | number:'1.2-2' }}</div>
                </div>
              </div>

              <!-- Remarks Section -->
              <div class="detail-item" *ngIf="selectedStock.remarks">
                <div class="detail-label">
                  <i class="fas fa-comment"></i> Remarks
                </div>
                <div class="detail-value">{{ selectedStock.remarks }}</div>
              </div>
            </div>

            <!-- Info Buttons Section -->
            <div class="info-buttons-section mt-4">
              <h6 class="section-title">
                <i class="fas fa-chart-bar"></i> Stock Information
              </h6>
              <div class="row">
                <!-- Availability Info -->
                <div class="col-md-4 mb-3">
                  <button class="btn btn-outline-info w-100 info-btn" (click)="showAvailabilityInfo()">
                    <i class="fas fa-boxes"></i>
                    <span>Availability</span>
                  </button>
                </div>

                <!-- Dispose Info -->
                <div class="col-md-4 mb-3">
                  <button class="btn btn-outline-warning w-100 info-btn" (click)="showDisposeInfo()">
                    <i class="fas fa-recycle"></i>
                    <span>Dispose Info</span>
                  </button>
                </div>

                <!-- In Use Components -->
                <div class="col-md-4 mb-3">
                  <button class="btn btn-outline-success w-100 info-btn" (click)="showInUseInfo()">
                    <i class="fas fa-desktop"></i>
                    <span>In Use Components</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Info Display Area -->
            <div class="info-display-area mt-3" *ngIf="currentInfoType">
              <div class="alert" [ngClass]="getInfoAlertClass()">
                <div class="info-header">
                  <i [class]="getInfoIcon()"></i>
                  <strong>{{ getInfoTitle() }}</strong>
                </div>
                <div class="info-content mt-2">
                  <div [innerHTML]="getInfoContent()"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Edit Stock Modal -->
<div class="modal-overlay" *ngIf="showEditStockModal" (click)="closeEditStockModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-title">
          <i class="fas fa-edit"></i>
          <div>
            <h1 class="page-title">Edit Stock Item</h1>
            <p class="page-subtitle">Update stock information</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-close" (click)="closeEditStockModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="modal-body">
      <!-- Edit Stock Form Content -->
      <div class="form-card">
        <div class="card">
          <div class="card-header">
            <h5><i class="fas fa-edit"></i> Stock Information</h5>
          </div>
          <div class="card-body">
            <form (ngSubmit)="saveEditStock()" #editStockForm="ngForm" class="stock-form">
              <div class="row">
                <!-- Item Selection (Read-only) -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-tag"></i> Item
                  </label>
                  <input type="text" class="form-control" [value]="getItemName(editStockModel.itemId)" readonly>
                </div>

                <!-- Storage Location -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-map-marker-alt"></i> Storage Location *
                  </label>
                  <select 
                    class="form-select" 
                    [(ngModel)]="editStockModel.locationId" 
                    name="locationId"
                    [class.is-invalid]="editStockSubmitted && !editStockModel.locationId"
                    required>
                    <option value="">Select Storage Location</option>
                    <option *ngFor="let location of locations" [value]="location.id">
                      {{ location.name }}
                    </option>
                  </select>
                  <div class="invalid-feedback" *ngIf="editStockSubmitted && !editStockModel.locationId">
                    Storage location is required
                  </div>
                </div>

                <!-- Quantity -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-sort-numeric-up"></i> Quantity *
                  </label>
                  <input 
                    type="number" 
                    class="form-control" 
                    [(ngModel)]="editStockModel.quantity" 
                    name="quantity"
                    (input)="onEditQuantityChange()"
                    [class.is-invalid]="editStockSubmitted && (!editStockModel.quantity || editStockModel.quantity <= 0)"
                    min="1"
                    required>
                  <div class="invalid-feedback" *ngIf="editStockSubmitted && (!editStockModel.quantity || editStockModel.quantity <= 0)">
                    Quantity must be greater than 0
                  </div>
                </div>

                <!-- Price -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-dollar-sign"></i> Price (per item) *
                  </label>
                  <input 
                    type="number" 
                    class="form-control" 
                    [(ngModel)]="editStockModel.price" 
                    name="price"
                    (input)="onEditPriceChange()"
                    [class.is-invalid]="editStockSubmitted && (!editStockModel.price || editStockModel.price <= 0)"
                    min="0.01"
                    step="0.01"
                    required>
                  <div class="invalid-feedback" *ngIf="editStockSubmitted && (!editStockModel.price || editStockModel.price <= 0)">
                    Price must be greater than 0
                  </div>
                </div>

                <!-- Total Price (Calculated) -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-calculator"></i> Total Price
                  </label>
                  <input 
                    type="text" 
                    class="form-control total-price" 
                    [value]="'php' + (editTotalPrice | number:'1.2-2')" 
                    readonly>
                </div>

                <!-- Remarks -->
                <div class="form-group col-md-6">
                  <label class="form-label">
                    <i class="fas fa-comment"></i> Remarks
                  </label>
                  <textarea 
                    class="form-control" 
                    [(ngModel)]="editStockModel.remarks" 
                    name="remarks"
                    rows="3"
                    placeholder="Optional remarks about this stock entry"></textarea>
                </div>
              </div>

              <!-- Form Actions -->
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="closeEditStockModal()">
                  <i class="fas fa-times"></i> Cancel
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="editStockLoading">
                  <i class="fas fa-save" *ngIf="!editStockLoading"></i>
                  <span class="spinner-border spinner-border-sm" *ngIf="editStockLoading"></span>
                  {{ editStockLoading ? 'Saving...' : 'Save Changes' }}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
