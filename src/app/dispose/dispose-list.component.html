<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-6">
  <div class="max-w-7xl mx-auto">
    <!-- Page Header -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-8 mb-8">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-lg flex items-center justify-center">
            <i class="fas fa-trash-alt text-white text-xl"></i>
          </div>
          <div>
            <h1 class="text-3xl font-bold text-gray-900 font-akira">Disposal Records</h1>
            <p class="text-gray-600 font-inter">Track and manage inventory disposal activities</p>
          </div>
        </div>
        <div class="flex flex-wrap gap-3">
          <button class="btn btn-primary" (click)="addNewDisposal()">
            <i class="fas fa-plus"></i>
            Add Disposal
          </button>
          <button class="btn btn-info" (click)="refreshStockData()" title="Refresh Stock Data">
            <i class="fas fa-sync-alt"></i>
            Refresh Stock
          </button>
        </div>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 text-center hover:shadow-xl transition-shadow duration-300">
        <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-lg flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-trash-alt text-white text-xl"></i>
        </div>
        <div class="text-2xl font-bold text-gray-900 font-akira">{{ disposals.length }}</div>
        <div class="text-sm text-gray-600 font-inter">Total Disposals</div>
      </div>
      <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 text-center hover:shadow-xl transition-shadow duration-300">
        <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-boxes text-white text-xl"></i>
        </div>
        <div class="text-2xl font-bold text-gray-900 font-akira">{{ getTotalDisposedItems() }}</div>
        <div class="text-sm text-gray-600 font-inter">Items Disposed</div>
      </div>
      <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 text-center hover:shadow-xl transition-shadow duration-300">
        <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-dollar-sign text-white text-xl"></i>
        </div>
        <div class="text-2xl font-bold text-gray-900 font-akira">{{ getTotalDisposalValue() | currency:'PHP':'symbol':'1.0-0' }}</div>
        <div class="text-sm text-gray-600 font-inter">Total Value</div>
      </div>
      <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 text-center hover:shadow-xl transition-shadow duration-300">
        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-calendar-alt text-white text-xl"></i>
        </div>
        <div class="text-2xl font-bold text-gray-900 font-akira">{{ getThisMonthDisposals() }}</div>
        <div class="text-sm text-gray-600 font-inter">This Month</div>
      </div>
    </div>

    <!-- Filters and Search -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6 mb-8">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <i class="fas fa-search text-gray-400"></i>
          </div>
          <input 
            type="text" 
            class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 font-inter" 
            placeholder="Search disposals..."
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
          >
        </div>
        <div>
          <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 font-inter" [(ngModel)]="selectedCategory" (change)="onFilterChange()">
            <option value="">All Categories</option>
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </div>
        <div>
          <select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 font-inter" [(ngModel)]="selectedLocation" (change)="onFilterChange()">
            <option value="">All Locations</option>
            <option *ngFor="let location of locations" [value]="location.id">
              {{ location.name }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <!-- Disposal Records Table -->
    <div class="bg-white rounded-lg shadow-md border border-gray-200">
      <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <h5 class="text-lg font-semibold text-gray-900 flex items-center gap-2 font-montserrat">
            <i class="fas fa-list text-blue-600"></i> Disposal Records
          </h5>
          <div class="flex gap-2">
            <button class="btn btn-sm btn-outline-secondary" (click)="refreshData()">
              <i class="fas fa-sync-alt"></i>
              Refresh
            </button>
          </div>
        </div>
      </div>
      <div class="p-0">
        <!-- Loading -->
        <div *ngIf="loading" class="text-center py-8">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
          <p class="mt-2 text-gray-600">Loading disposal records...</p>
        </div>

        <!-- Table -->
        <div *ngIf="!loading" class="overflow-x-auto">
          <table class="w-full border-collapse min-w-full">
            <thead>
              <tr class="bg-gray-50">
                <th class="px-0 py-0 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200 font-montserrat w-48">
                  <i class="fas fa-box mr-0"></i> Item
                </th>
                <th class="px-0 py-0 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200 font-montserrat w-24">
                  <i class="fas fa-tag mr-0"></i> Category
                </th>
                <th class="px-0 py-0 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200 font-montserrat w-32">
                  <i class="fas fa-trademark mr-0"></i> Brand
                </th>
                <th class="px-0 py-0 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200 font-montserrat w-32">
                  <i class="fas fa-sort-numeric-up mr-0"></i> Quantity
                </th>
                <th class="px-0 py-0 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200 font-montserrat w-24">
                  <i class="fas fa-dollar-sign mr-0"></i> Price
                </th>
                <th class="px-0 py-0 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200 font-montserrat w-24">
                  <i class="fas fa-calculator mr-0"></i> Total Value
                </th>
                <th class="px-0 py-0 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200 font-montserrat w-32">
                  <i class="fas fa-map-marker-alt mr-0"></i> Location
                </th>
                <th class="px-0 py-0 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200 font-montserrat w-40">
                  <i class="fas fa-comment mr-0"></i> Reason
                </th>
                <th class="px-0 py-0 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200 font-montserrat w-40">
                  <i class="fas fa-user mr-0"></i> Disposed By
                </th>
                <th class="px-0 py-0 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200 font-montserrat w-24">
                  <i class="fas fa-calendar mr-0"></i> Date
                </th>
                <th class="px-0 py-0 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b border-gray-200 font-montserrat w-32">
                  <i class="fas fa-cogs mr-0"></i> Actions
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let disposal of paginatedDisposals" class="hover:bg-gray-50 transition-colors duration-200 border-b border-gray-200">
                <td class="px-0 py-0 text-sm text-gray-900 border-b border-gray-200 font-inter w-48" data-label="Item">
                  <div class="item-info">
                    <strong class="font-montserrat text-xs">{{ disposal.item?.name || 'Unknown Item' }}</strong>
                    <small class="d-block text-gray-500 font-inter text-xs" *ngIf="disposal.item?.description">
                      {{ disposal.item.description }}
                    </small>
                  </div>
                </td>
                <td class="px-0 py-0 text-sm text-gray-900 border-b border-gray-200 font-inter w-24" data-label="Category">
                  <span class="category-badge text-xs">
                    {{ disposal.item?.category?.name || 'No Category' }}
                  </span>
                </td>
                <td class="px-0 py-0 text-sm text-gray-900 border-b border-gray-200 font-inter w-32" data-label="Brand">
                  <span class="brand-badge text-xs">
                    {{ disposal.item?.brand?.name || 'No Brand' }}
                  </span>
                </td>
                <td class="px-0 py-0 text-sm text-gray-900 border-b border-gray-200 font-inter w-32" data-label="Quantity">
                  <span class="quantity-badge badge-danger text-xs">
                    {{ disposal.quantity }}
                  </span>
                  <span *ngIf="disposal.returnedToStock" class="badge badge-success ms-1 text-xs">
                    <i class="fas fa-check"></i> Returned
                  </span>
                  <span *ngIf="disposal.quantity < disposal.originalQuantity" class="badge badge-warning ms-1 text-xs">
                    <i class="fas fa-undo"></i> Partially Returned
                  </span>
                </td>
                <td class="px-0 py-0 text-sm text-gray-900 border-b border-gray-200 font-inter w-24" data-label="Price">
                  <span class="price-value text-xs">
                    {{ getDisposalValueForItem(disposal) | currency:'PHP':'symbol' }}
                  </span>
                </td>
                <td class="px-0 py-0 text-sm text-gray-900 border-b border-gray-200 font-inter w-24" data-label="Total Value">
                  <span class="total-value text-xs">
                    {{ getTotalValueForItem(disposal) | currency:'PHP':'symbol' }}
                  </span>
                </td>
                <td class="px-0 py-0 text-sm text-gray-900 border-b border-gray-200 font-inter w-32" data-label="Location">
                  <span class="location-badge text-xs">
                    {{ disposal.location?.name || 'No Location' }}
                    <small class="d-block text-gray-500 font-inter text-xs" *ngIf="disposal.location?.description">
                      {{ disposal.location.description }}
                    </small>
                  </span>
                </td>
                <td class="px-0 py-0 text-sm text-gray-900 border-b border-gray-200 font-inter w-40" data-label="Reason">
                  <span class="reason-text text-xs" [title]="disposal.reason || 'No reason provided'">
                    {{ (disposal.reason || 'No reason provided') | slice:0:30 }}{{ (disposal.reason || '').length > 30 ? '...' : '' }}
                  </span>
                </td>
                <td class="px-0 py-0 text-sm text-gray-900 border-b border-gray-200 font-inter w-40" data-label="Disposed By">
                  <span class="user-badge">
                    <span class="font-montserrat text-xs">{{ disposal.user?.firstName }} {{ disposal.user?.lastName }}</span>
                    <small class="d-block text-gray-500 font-inter text-xs" *ngIf="disposal.user?.email">
                      {{ disposal.user.email }}
                    </small>
                  </span>
                </td>
                <td class="px-0 py-0 text-sm text-gray-900 border-b border-gray-200 font-inter w-24" data-label="Date">
                  <span class="date-badge text-xs">
                    {{ disposal.disposalDate | date: 'MMM dd, yyyy' }}
                  </span>
                </td>
                <td class="px-0 py-0 text-sm text-gray-900 border-b border-gray-200 font-inter w-32" data-label="Actions">
                  <div class="flex flex-row gap-0">
                    <button class="btn btn-sm btn-outline-primary p-1 m-0"
                            (click)="viewDisposal(disposal.id!)" title="View Details">
                      <i class="fas fa-eye text-xs"></i>
                    </button>
                    <button *ngIf="hasRole([Role.SuperAdmin, Role.Admin])" 
                            class="btn btn-sm btn-outline-warning p-1 m-0"
                            (click)="editDisposal(disposal.id!)" title="Edit Disposal">
                      <i class="fas fa-edit text-xs"></i>
                    </button>
                    <button *ngIf="hasRole([Role.SuperAdmin, Role.Admin])" 
                            class="btn btn-sm btn-outline-danger p-1 m-0"
                            (click)="deleteDisposal(disposal.id!)" title="Delete Disposal">
                      <i class="fas fa-trash text-xs"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-info p-1 m-0"
                            (click)="viewStockInfo(disposal.itemId)" title="Stock Info">
                      <i class="fas fa-boxes text-xs"></i>
                    </button>
                    <button *ngIf="disposal.quantity > 0" 
                            class="btn btn-sm btn-outline-success p-1 m-0"
                            (click)="returnToStock(disposal)" title="Return to Stock">
                      <i class="fas fa-undo text-xs"></i>
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filteredDisposals?.length === 0">
                <td colspan="11" class="px-4 py-8 text-center text-gray-500">
                  <div class="empty-state">
                    <i class="fas fa-trash-alt text-4xl mb-4"></i>
                    <h4 class="text-lg font-semibold mb-2 font-montserrat">No disposal records found</h4>
                    <p class="text-sm font-inter">Try adjusting your search or filters</p>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-section" *ngIf="filteredDisposals?.length > 0">
      <div class="pagination-info">
        Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, filteredDisposals.length) }} of {{ filteredDisposals.length }} entries
      </div>
      <nav aria-label="Disposal pagination">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="previousPage()">
              <i class="fas fa-chevron-left"></i>
            </a>
          </li>
          <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage">
            <a class="page-link" (click)="goToPage(page)">{{ page }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="nextPage()">
              <i class="fas fa-chevron-right"></i>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- Add Disposal Modal -->
  <div class="modal-overlay" *ngIf="showAddDisposalModal" (click)="closeAddDisposalModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="header-content">
          <div class="header-title">
            <i class="fas fa-trash-alt"></i>
            <div>
              <h1 class="page-title">Dispose Items</h1>
              <p class="page-subtitle">Manage inventory disposal records</p>
            </div>
          </div>
          <div class="header-actions">
            <button class="btn btn-close" (click)="closeAddDisposalModal()">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="modal-body">
                                   <!-- Available Stock Alert -->
          <div class="alert alert-info" *ngIf="availableStock > 0">
            <strong>Available Stock:</strong> {{ availableStock }} units
            <button type="button" class="btn btn-sm btn-outline-info ms-2" (click)="refreshStockData()" title="Refresh Stock Data">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
          </div>

          <!-- Debug Info -->
          <div class="alert alert-secondary">
            <strong>Debug Info:</strong><br>
            Available Stock Entries: {{ availableStockEntries.length }}<br>
            Selected Stock Entry ID: {{ form.value.stockEntryId || 'None' }}<br>
            Available Stock: {{ availableStock }}<br>
            Selected Item Price: {{ selectedItemPrice }}<br>
            <button type="button" class="btn btn-sm btn-outline-secondary mt-2" (click)="debugStockData()" title="Debug Stock Data">
              <i class="fas fa-bug"></i> Debug Data
            </button>
          </div>

                                       <!-- No Stock Available Alert -->
          <div class="alert alert-warning" *ngIf="availableStock === 0 && form.value.stockEntryId">
            <strong>No stock available</strong> for the selected stock entry.
          </div>

          <!-- Selected Stock Summary -->
          <div class="alert alert-info" *ngIf="form.value.stockEntryId && availableStock > 0">
            <div class="row">
              <div class="col-md-6">
                <strong>Selected Stock Entry:</strong><br>
                <span *ngIf="getSelectedStock()">
                  <strong>Item:</strong> {{ getSelectedStock()?.item?.name }}<br>
                  <strong>Category:</strong> {{ getSelectedStock()?.item?.category?.name }}<br>
                  <strong>Brand:</strong> {{ getSelectedStock()?.item?.brand?.name }}<br>
                  <strong>Available:</strong> {{ availableStock }} units<br>
                  <strong>Price:</strong> ₱{{ selectedItemPrice | number:'1.2-2' }} per unit
                </span>
              </div>
              <div class="col-md-6">
                <strong>Disposal Summary:</strong><br>
                <strong>Quantity to Dispose:</strong> {{ form.value.quantity || 0 }} units<br>
                <strong>Total Value:</strong> ₱{{ getTotalValue() | number:'1.2-2' }}<br>
                <strong>Location:</strong> {{ getSelectedStockLocation() }}
              </div>
            </div>
          </div>

        <form [formGroup]="form" (ngSubmit)="onSubmit()">
                     <!-- Stock Selection -->
           <div class="mb-3">
                           <label class="form-label">
                <i class="fas fa-boxes"></i> Select Stock Entry
              </label>
                                         <select formControlName="stockEntryId" class="form-control" 
                      [ngClass]="{ 'is-invalid': submitted && f.stockEntryId.errors }"
                      [disabled]="loading">
                <option value="">Select Stock Entry</option>
                <option *ngFor="let stock of availableStockEntries" [value]="stock.id">
                  {{ stock.item?.name || 'Unknown Item' }} ({{ stock.item?.category?.name }}) - {{ stock.quantity }} units - ₱{{ stock.price | number:'1.2-2' }} each - {{ stock.location?.name }} - {{ stock.createdAt | date:'MMM dd, yyyy HH:mm' }}
                </option>
              </select>
              <div *ngIf="submitted && f.stockEntryId.errors" class="invalid-feedback">
                <div *ngIf="f.stockEntryId.errors.required">Stock entry is required</div>
              </div>
              <small class="form-text text-muted">
                Shows: Item Name (Category) - Available Quantity - Price per unit - Location - Date Added
              </small>
           </div>

                     <!-- Quantity -->
           <div class="mb-3">
             <label class="form-label">
               <i class="fas fa-sort-numeric-up"></i> Quantity to Dispose
             </label>
                                         <input type="number" formControlName="quantity" class="form-control" 
                      [ngClass]="{ 'is-invalid': submitted && f.quantity.errors }"
                      min="1"
                      [max]="availableStock"
                      [disabled]="loading || !form.value.stockEntryId"
                      placeholder="Enter quantity to dispose">
             <div *ngIf="submitted && f.quantity.errors" class="invalid-feedback">
               <div *ngIf="f.quantity.errors.required">Quantity is required</div>
               <div *ngIf="f.quantity.errors.min">Quantity must be at least 1</div>
               <div *ngIf="f.quantity.errors.maxQuantity">Quantity cannot exceed available stock ({{ f.quantity.errors.maxQuantity.max }} units)</div>
             </div>
             <small class="form-text text-muted" *ngIf="availableStock > 0">
               <i class="fas fa-info-circle"></i> Maximum available: {{ availableStock }} units | 
               <strong>Total Value:</strong> ₱{{ getTotalValue() | number:'1.2-2' }}
             </small>
                           <small class="form-text text-warning" *ngIf="availableStock === 0 && form.value.stockEntryId">
                <i class="fas fa-exclamation-circle"></i> No stock available for disposal
              </small>
           </div>

          <!-- Location (Auto-populated) -->
          <div class="mb-3">
            <label class="form-label">
              <i class="fas fa-map-marker-alt"></i> Storage Location
            </label>
            <input type="text" class="form-control" 
                   [value]="getSelectedStockLocation()" 
                   readonly 
                   style="background-color: #f8f9fa;">
            <small class="form-text text-muted">
              <i class="fas fa-info-circle"></i> Location is automatically set from the selected stock entry
            </small>
          </div>



          <!-- Reason -->
          <div class="mb-3">
            <label class="form-label">
              <i class="fas fa-comment"></i> Reason
            </label>
                         <textarea formControlName="reason" class="form-control" rows="3"
                       placeholder="Reason for disposal, condition, etc."
                       [disabled]="loading"></textarea>
          </div>

          <!-- Buttons -->
          <div class="mb-3">
                         <button type="submit" class="btn btn-danger" 
                     [disabled]="loading || form.invalid">
               <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>
               Dispose Units
             </button>
                         <button type="button" class="btn btn-warning ms-2" 
                     (click)="disposeAll()" 
                     [disabled]="loading || availableStock === 0 || !form.value.stockEntryId">
               <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>
               Dispose All Available Units
             </button>
            <button type="button" class="btn btn-secondary ms-2" (click)="closeAddDisposalModal()" [class.disabled]="loading">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Return to Stock Modal -->
  <div class="modal-overlay" *ngIf="showReturnToStockModal" (click)="closeReturnToStockModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="header-content">
          <div class="header-title">
            <i class="fas fa-undo"></i>
            <div>
              <h1 class="page-title">Return to Stock</h1>
              <p class="page-subtitle">Return disposed items back to inventory</p>
            </div>
          </div>
          <div class="header-actions">
            <button class="btn btn-close" (click)="closeReturnToStockModal()">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="modal-body">
        <!-- Item Information -->
        <div class="alert alert-info">
          <div class="row">
            <div class="col-md-6">
              <strong>Item:</strong> {{ selectedDisposal?.item?.name || 'Unknown Item' }}<br>
              <strong>Category:</strong> {{ selectedDisposal?.item?.category?.name || 'No Category' }}<br>
              <strong>Brand:</strong> {{ selectedDisposal?.item?.brand?.name || 'No Brand' }}
            </div>
            <div class="col-md-6">
              <strong>Current Disposed:</strong> {{ selectedDisposal?.quantity || 0 }} units<br>
              <strong>Disposal Value:</strong> {{ getDisposalValue() | currency:'PHP':'symbol' }}<br>
              <strong>Location:</strong> {{ selectedDisposal?.location?.name || 'No Location' }}
            </div>
          </div>
        </div>

        <form [formGroup]="returnForm" (ngSubmit)="onReturnSubmit()">
          <!-- Quantity to Return -->
          <div class="mb-3">
            <label class="form-label">
              <i class="fas fa-sort-numeric-up"></i> Quantity to Return
            </label>
            <input type="number" formControlName="quantity" class="form-control" 
                   [ngClass]="{ 'is-invalid': returnSubmitted && returnForm.get('quantity')?.errors }"
                   min="1"
                   [max]="selectedDisposal?.quantity || 1"
                   placeholder="Enter quantity to return to stock">
            <div *ngIf="returnSubmitted && returnForm.get('quantity')?.errors" class="invalid-feedback">
              <div *ngIf="returnForm.get('quantity')?.errors?.['required']">Quantity is required</div>
              <div *ngIf="returnForm.get('quantity')?.errors?.['min']">Quantity must be at least 1</div>
              <div *ngIf="returnForm.get('quantity')?.errors?.['max']">Quantity cannot exceed disposed amount</div>
            </div>
            <small class="form-text text-muted">
              <i class="fas fa-info-circle"></i> Maximum: {{ selectedDisposal?.quantity || 0 }} units | 
              <strong>Total Value:</strong> ₱{{ getReturnTotalValue() | number:'1.2-2' }}
            </small>
          </div>

          <!-- Remarks -->
          <div class="mb-3">
            <label class="form-label">
              <i class="fas fa-comment"></i> Remarks
            </label>
            <textarea formControlName="remarks" class="form-control" rows="3"
                      placeholder="Reason for returning to stock, condition, etc."></textarea>
            <small class="form-text text-muted">
              <i class="fas fa-info-circle"></i> Optional: Add notes about the return
            </small>
          </div>

          <!-- Buttons -->
          <div class="mb-3">
            <button type="submit" class="btn btn-success" 
                    [disabled]="loading || returnForm.invalid">
              <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>
              Return to Stock
            </button>
            <button type="button" class="btn btn-warning ms-2" 
                    (click)="returnAll()" 
                    [disabled]="loading || !selectedDisposal?.quantity">
              <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>
              Return All Units
            </button>
            <button type="button" class="btn btn-secondary ms-2" (click)="closeReturnToStockModal()" [class.disabled]="loading">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div> 