<div class="analytics-container">
  <!-- Header -->
  <div class="analytics-header">
    <div class="analytics-title">
      <i class="fas fa-chart-line"></i>
      ðŸ“Š Advanced Analytics Dashboard
    </div>
    <div class="analytics-subtitle">
      Comprehensive insights into inventory patterns, component usage, and system performance
    </div>
  </div>

  <!-- Summary Statistics -->
  <div class="summary-stats" *ngIf="advancedAnalytics">
    <div class="summary-card">
      <div class="summary-number">{{ advancedAnalytics.topCategories?.length || 0 }}</div>
      <div class="summary-label">Top Categories</div>
    </div>
    <div class="summary-card">
      <div class="summary-number">{{ advancedAnalytics.mostReplacedComponents?.length || 0 }}</div>
      <div class="summary-label">Replaced Components</div>
    </div>
    <div class="summary-card">
      <div class="summary-number">{{ advancedAnalytics.averageLifespan?.length || 0 }}</div>
      <div class="summary-label">Lifespan Categories</div>
    </div>
    <div class="summary-card">
      <div class="summary-number">{{ advancedAnalytics.pendingRequests?.length || 0 }}</div>
      <div class="summary-label">Pending Requests</div>
    </div>
    <div class="summary-card">
      <div class="summary-number">{{ advancedAnalytics.lowStockItems?.length || 0 }}</div>
      <div class="summary-label">Low Stock Items</div>
    </div>
    <div class="summary-card">
      <div class="summary-number">{{ advancedAnalytics.outOfStockItems?.length || 0 }}</div>
      <div class="summary-label">Out of Stock</div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
  </div>


  <!-- Analytics Grid -->
  <div class="analytics-grid" *ngIf="advancedAnalytics && !loading">
    <!-- Top Used Categories -->
    <div class="analytics-card">
      <div class="card-header">
        <div class="card-icon categories-icon">
          <i class="fas fa-tags"></i>
        </div>
        <div>
          <div class="card-title">Top Used Categories</div>
          <div class="card-description">Most frequently used component categories</div>
        </div>
      </div>
      <div class="analytics-content">
        <div class="analytics-item" *ngFor="let category of advancedAnalytics.topCategories; let i = index">
          <div class="item-name">{{ i + 1 }}. {{ category.category }}</div>
          <div>
            <span class="item-value">{{ formatNumber(category.usage) }}</span>
            <span class="item-percentage">({{ formatNumber(category.percentage) }}%)</span>
          </div>
        </div>
        <div class="no-data" *ngIf="!advancedAnalytics.topCategories?.length">
          <i class="fas fa-chart-bar"></i>
          <div>No category data available</div>
        </div>
      </div>
    </div>

    <!-- Most Replaced Components -->
    <div class="analytics-card">
      <div class="card-header">
        <div class="card-icon components-icon">
          <i class="fas fa-exchange-alt"></i>
        </div>
        <div>
          <div class="card-title">Most Replaced Components</div>
          <div class="card-description">Components with highest replacement frequency</div>
        </div>
      </div>
      <div class="analytics-content">
        <div class="analytics-item" *ngFor="let component of advancedAnalytics.mostReplacedComponents; let i = index">
          <div>
            <div class="item-name">{{ i + 1 }}. {{ component.name }}</div>
            <div style="font-size: 0.8rem; color: #666;">{{ component.category }} - {{ component.brand }}</div>
          </div>
          <div>
            <span class="item-value">{{ component.replacementCount }}</span>
            <span class="item-percentage">times</span>
          </div>
        </div>
        <div class="no-data" *ngIf="!advancedAnalytics.mostReplacedComponents?.length">
          <i class="fas fa-exchange-alt"></i>
          <div>No replacement data available</div>
        </div>
      </div>
    </div>

    <!-- Average Component Lifespan -->
    <div class="analytics-card">
      <div class="card-header">
        <div class="card-icon lifespan-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div>
          <div class="card-title">Average Component Lifespan</div>
          <div class="card-description">Expected lifespan by category</div>
        </div>
      </div>
      <div class="analytics-content">
        <div class="analytics-item" *ngFor="let lifespan of advancedAnalytics.averageLifespan; let i = index">
          <div class="item-name">{{ lifespan.category }}</div>
          <div>
            <span class="item-value">{{ formatNumber(lifespan.averageLifespan, 1) }}</span>
            <span class="item-percentage">days</span>
          </div>
        </div>
        <div class="no-data" *ngIf="!advancedAnalytics.averageLifespan?.length">
          <i class="fas fa-clock"></i>
          <div>No lifespan data available</div>
        </div>
      </div>
    </div>

    <!-- Pending Requests -->
    <div class="analytics-card">
      <div class="card-header">
        <div class="card-icon requests-icon">
          <i class="fas fa-hourglass-half"></i>
        </div>
        <div>
          <div class="card-title">Pending Requests</div>
          <div class="card-description">Items awaiting approval</div>
        </div>
      </div>
      <div class="analytics-content">
        <div class="analytics-item" *ngFor="let request of advancedAnalytics.pendingRequests; let i = index">
          <div>
            <div class="item-name">{{ request.itemName }}</div>
            <div style="font-size: 0.8rem; color: #666;">{{ request.category }} - {{ request.requestedBy }}</div>
          </div>
          <div>
            <span class="item-value">{{ request.quantity }}</span>
            <span class="item-percentage">units</span>
          </div>
        </div>
        <div class="no-data" *ngIf="!advancedAnalytics.pendingRequests?.length">
          <i class="fas fa-check-circle"></i>
          <div>No pending requests</div>
        </div>
      </div>
    </div>

    <!-- Low Stock Items -->
    <div class="analytics-card">
      <div class="card-header">
        <div class="card-icon" style="background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div>
          <div class="card-title">Low Stock Items</div>
          <div class="card-description">Items below threshold</div>
        </div>
      </div>
      <div class="analytics-content">
        <div class="analytics-item" *ngFor="let item of advancedAnalytics.lowStockItems; let i = index">
          <div>
            <div class="item-name">{{ item.name }}</div>
            <div style="font-size: 0.8rem; color: #666;">{{ item.category }} - {{ item.brand }}</div>
          </div>
          <div>
            <span class="item-value">{{ item.currentStock }}</span>
            <span class="item-percentage">/ {{ item.threshold }}</span>
          </div>
        </div>
        <div class="no-data" *ngIf="!advancedAnalytics.lowStockItems?.length">
          <i class="fas fa-check-circle"></i>
          <div>All items are well stocked</div>
        </div>
      </div>
    </div>

    <!-- Out of Stock Items -->
    <div class="analytics-card">
      <div class="card-header">
        <div class="card-icon" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">
          <i class="fas fa-times-circle"></i>
        </div>
        <div>
          <div class="card-title">Out of Stock Items</div>
          <div class="card-description">Items with zero inventory</div>
        </div>
      </div>
      <div class="analytics-content">
        <div class="analytics-item" *ngFor="let item of advancedAnalytics.outOfStockItems; let i = index">
          <div>
            <div class="item-name">{{ item.name }}</div>
            <div style="font-size: 0.8rem; color: #666;">{{ item.category }} - {{ item.brand }}</div>
          </div>
          <div>
            <span class="item-value" style="color: #dc3545;">0</span>
            <span class="item-percentage">units</span>
          </div>
        </div>
        <div class="no-data" *ngIf="!advancedAnalytics.outOfStockItems?.length">
          <i class="fas fa-check-circle"></i>
          <div>No out of stock items</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Visual Analytics Charts Section -->
  <div class="charts-section" *ngIf="advancedAnalytics && !loading">
    <div class="charts-grid">
      <!-- Top Categories Chart -->
      <div class="chart-container">
        <div class="chart-title">
          <i class="fas fa-chart-pie"></i>
          Top Used Categories
        </div>
        <div class="chart-wrapper">
          <canvas id="topCategoriesChart"></canvas>
        </div>
      </div>

      <!-- Most Replaced Components Chart -->
      <div class="chart-container">
        <div class="chart-title">
          <i class="fas fa-chart-bar"></i>
          Most Replaced Components
        </div>
        <div class="chart-wrapper">
          <canvas id="replacementPatternsChart"></canvas>
        </div>
      </div>

      <!-- Stock Levels Chart -->
      <div class="chart-container">
        <div class="chart-title">
          <i class="fas fa-chart-pie"></i>
          Stock Level Distribution
        </div>
        <div class="chart-wrapper">
          <canvas id="stockLevelsChart"></canvas>
        </div>
      </div>

      <!-- Component Lifespan Chart -->
      <div class="chart-container">
        <div class="chart-title">
          <i class="fas fa-chart-bar"></i>
          Average Component Lifespan
        </div>
        <div class="chart-wrapper">
          <canvas id="lifespanChart"></canvas>
        </div>
      </div>

      <!-- Monthly Trends Chart -->
      <div class="chart-container full-width">
        <div class="chart-title">
          <i class="fas fa-chart-line"></i>
          Monthly Inventory Trends
        </div>
        <div class="chart-wrapper">
          <canvas id="monthlyTrendsChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Replacement Patterns Data -->
  <div class="chart-container" *ngIf="advancedAnalytics?.replacementPatterns && !loading">
    <div class="chart-title">Component Replacement Patterns</div>
    <div class="analytics-content">
      <div *ngFor="let pattern of getObjectEntries(advancedAnalytics.replacementPatterns.reasonPatterns)">
        <h4>{{ pattern[0] }}</h4>
        <div class="analytics-item" *ngFor="let reason of getObjectEntries(pattern[1])">
          <div class="item-name">{{ reason[0] }}</div>
          <div class="item-value">{{ reason[1] }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Automated Report Scheduling -->
  <div class="automated-schedule-section" *ngIf="automatedSchedule">
    <div class="schedule-header">
      <div class="schedule-title">
        <i class="fas fa-calendar-alt"></i>
        Automated Report Scheduling
      </div>
      <button class="btn btn-primary" (click)="saveAutomatedSchedule()" [disabled]="loading">
        <i class="fas fa-save"></i>
        Save Schedule
      </button>
    </div>

    <div class="schedule-form">
      <!-- Weekly Reports -->
      <div class="form-group">
        <label class="form-label">Weekly Reports</label>
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox" [(ngModel)]="scheduleForm.weeklyReports.enabled" id="weeklyEnabled">
            <label for="weeklyEnabled">Enable Weekly Reports</label>
          </div>
        </div>
        <div *ngIf="scheduleForm.weeklyReports.enabled">
          <input type="number" class="form-control" placeholder="Day of Week (1-7)" 
                 [(ngModel)]="scheduleForm.weeklyReports.dayOfWeek" min="1" max="7">
          <input type="time" class="form-control" [(ngModel)]="scheduleForm.weeklyReports.time">
        </div>
      </div>

      <!-- Monthly Reports -->
      <div class="form-group">
        <label class="form-label">Monthly Reports</label>
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox" [(ngModel)]="scheduleForm.monthlyReports.enabled" id="monthlyEnabled">
            <label for="monthlyEnabled">Enable Monthly Reports</label>
          </div>
        </div>
        <div *ngIf="scheduleForm.monthlyReports.enabled">
          <input type="number" class="form-control" placeholder="Day of Month (1-31)" 
                 [(ngModel)]="scheduleForm.monthlyReports.dayOfMonth" min="1" max="31">
          <input type="time" class="form-control" [(ngModel)]="scheduleForm.monthlyReports.time">
        </div>
      </div>

      <!-- Low Stock Alerts -->
      <div class="form-group">
        <label class="form-label">Low Stock Alerts</label>
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox" [(ngModel)]="scheduleForm.lowStockAlerts.enabled" id="lowStockEnabled">
            <label for="lowStockEnabled">Enable Low Stock Alerts</label>
          </div>
        </div>
        <div *ngIf="scheduleForm.lowStockAlerts.enabled">
          <input type="number" class="form-control" placeholder="Threshold" 
                 [(ngModel)]="scheduleForm.lowStockAlerts.threshold" min="1">
        </div>
      </div>

      <!-- Out of Stock Alerts -->
      <div class="form-group">
        <label class="form-label">Out of Stock Alerts</label>
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox" [(ngModel)]="scheduleForm.outOfStockAlerts.enabled" id="outOfStockEnabled">
            <label for="outOfStockEnabled">Enable Out of Stock Alerts</label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div style="text-align: center; margin-top: 30px;">
    <button class="btn btn-primary" (click)="refreshAnalytics()" [disabled]="loading">
      <i class="fas fa-sync-alt"></i>
      Refresh Analytics & Charts
    </button>
    <button class="btn btn-success" routerLink="/analytics/realtime" style="margin-left: 15px;">
      <i class="fas fa-chart-line"></i>
      View Real-Time Dashboard
    </button>
  </div>
</div>
