<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-200 py-6">
  <div class="max-w-7xl mx-auto px-4">
  <!-- Header -->
    <div class="bg-white rounded-2xl shadow-lg mb-6 overflow-hidden">
      <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-4">
        <div class="flex items-center">
          <div class="w-14 h-14 bg-white/20 text-white rounded-full flex items-center justify-center mr-3 text-xl">
      <i class="fas fa-chart-line"></i>
          </div>
          <div>
            <h1 class="text-2xl font-black text-white font-akira mb-1">ðŸ“Š Advanced Analytics Dashboard</h1>
            <p class="text-white/80 font-inter text-sm">Comprehensive insights into inventory patterns, component usage, and system performance</p>
          </div>
    </div>
    </div>
  </div>

  <!-- Summary Statistics -->
    <div *ngIf="advancedAnalytics" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
      <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 text-center hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
        <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center mx-auto mb-3">
          <i class="fas fa-tags text-white text-xl"></i>
        </div>
        <div class="text-2xl font-bold text-indigo-600 font-akira mb-1">{{ advancedAnalytics.topCategories?.length || 0 }}</div>
        <div class="text-xs text-gray-600 font-inter uppercase tracking-wide">Top Categories</div>
      </div>
      <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 text-center hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
        <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-xl flex items-center justify-center mx-auto mb-3">
          <i class="fas fa-exchange-alt text-white text-xl"></i>
        </div>
        <div class="text-2xl font-bold text-orange-600 font-akira mb-1">{{ advancedAnalytics.mostReplacedComponents?.length || 0 }}</div>
        <div class="text-xs text-gray-600 font-inter uppercase tracking-wide">Replaced Components</div>
      </div>
      <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 text-center hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
        <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-teal-500 rounded-xl flex items-center justify-center mx-auto mb-3">
          <i class="fas fa-clock text-white text-xl"></i>
        </div>
        <div class="text-2xl font-bold text-green-600 font-akira mb-1">{{ advancedAnalytics.averageLifespan?.length || 0 }}</div>
        <div class="text-xs text-gray-600 font-inter uppercase tracking-wide">Lifespan Categories</div>
      </div>
      <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 text-center hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
        <div class="w-12 h-12 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-xl flex items-center justify-center mx-auto mb-3">
          <i class="fas fa-hourglass-half text-white text-xl"></i>
    </div>
        <div class="text-2xl font-bold text-yellow-600 font-akira mb-1">{{ advancedAnalytics.pendingRequests?.length || 0 }}</div>
        <div class="text-xs text-gray-600 font-inter uppercase tracking-wide">Pending Requests</div>
    </div>
      <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 text-center hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-xl flex items-center justify-center mx-auto mb-3">
          <i class="fas fa-exclamation-triangle text-white text-xl"></i>
    </div>
        <div class="text-3xl font-bold text-blue-600 font-akira mb-1">{{ advancedAnalytics.lowStockItems?.length || 0 }}</div>
        <div class="text-sm text-gray-600 font-inter uppercase tracking-wide">Low Stock Items</div>
    </div>
      <div class="bg-white rounded-xl shadow-md border border-gray-200 p-6 text-center hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
        <div class="w-14 h-14 bg-gradient-to-br from-red-500 to-pink-500 rounded-xl flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-times-circle text-white text-2xl"></i>
    </div>
        <div class="text-3xl font-bold text-red-600 font-akira mb-1">{{ advancedAnalytics.outOfStockItems?.length || 0 }}</div>
        <div class="text-sm text-gray-600 font-inter uppercase tracking-wide">Out of Stock</div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
  </div>

  <!-- Monthly Stock Chart -->
  <div class="analytics-card" *ngIf="!chartLoading">
    <div class="card-header">
      <div class="card-icon" style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);">
        <i class="fas fa-chart-line"></i>
      </div>
      <div>
        <div class="card-title">Monthly Stock Entries</div>
        <div class="card-description">Stock entries added by month over the last 12 months</div>
      </div>
    </div>
    <div echarts [options]="stockChartOption" style="height: 400px;"></div>
  </div>

  <!-- Monthly Disposal Chart -->
  <div class="analytics-card" *ngIf="!disposalChartLoading">
    <div class="card-header">
      <div class="card-icon" style="background: linear-gradient(135deg, #dc3545 0%, #a71d2a 100%);">
        <i class="fas fa-trash"></i>
      </div>
      <div>
        <div class="card-title">Monthly Disposals</div>
        <div class="card-description">Disposed quantities over the last 12 months</div>
      </div>
    </div>
    <div echarts [options]="disposalChartOption" style="height: 400px;"></div>
  </div>

  <!-- Disposal Chart Loading State -->
  <div class="analytics-card" *ngIf="disposalChartLoading">
    <div class="card-header">
      <div class="card-icon" style="background: linear-gradient(135deg, #dc3545 0%, #a71d2a 100%);">
        <i class="fas fa-trash"></i>
      </div>
      <div>
        <div class="card-title">Monthly Disposals</div>
        <div class="card-description">Loading chart data...</div>
      </div>
    </div>
    <div class="loading">
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Chart Loading State -->
  <div class="analytics-card" *ngIf="chartLoading">
    <div class="card-header">
      <div class="card-icon" style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);">
        <i class="fas fa-chart-line"></i>
      </div>
      <div>
        <div class="card-title">Monthly Stock Entries</div>
        <div class="card-description">Loading chart data...</div>
      </div>
    </div>
    <div class="loading">
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Category Pie Chart -->
  <div class="analytics-card" *ngIf="!categoryPieLoading">
    <div class="card-header">
      <div class="card-icon categories-icon">
        <i class="fas fa-chart-pie"></i>
      </div>
      <div>
        <div class="card-title">Top Stock Categories</div>
        <div class="card-description">Stock distribution by category (Top 10)</div>
      </div>
    </div>
    <div echarts [options]="categoryPieOption" style="height: 400px;"></div>
  </div>

  <!-- Category Pie Loading State -->
  <div class="analytics-card" *ngIf="categoryPieLoading">
    <div class="card-header">
      <div class="card-icon categories-icon">
        <i class="fas fa-chart-pie"></i>
      </div>
      <div>
        <div class="card-title">Top Stock Categories</div>
        <div class="card-description">Loading chart data...</div>
      </div>
    </div>
    <div class="loading">
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Item Lifespan Chart -->
  <div class="analytics-card" *ngIf="!lifespanChartLoading">
    <div class="card-header">
      <div class="card-icon" style="background: linear-gradient(135deg, #17a2b8 0%, #117a8b 100%);">
        <i class="fas fa-clock"></i>
      </div>
      <div>
        <div class="card-title">Item Lifespan</div>
        <div class="card-description">Days from stock entry to disposal</div>
      </div>
    </div>
    <div echarts [options]="lifespanChartOption" style="height: 400px;"></div>
  </div>

  <!-- Item Lifespan Loading State -->
  <div class="analytics-card" *ngIf="lifespanChartLoading">
    <div class="card-header">
      <div class="card-icon" style="background: linear-gradient(135deg, #17a2b8 0%, #117a8b 100%);">
        <i class="fas fa-clock"></i>
      </div>
      <div>
        <div class="card-title">Item Lifespan</div>
        <div class="card-description">Loading chart data...</div>
      </div>
    </div>
    <div class="loading">
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Most Stock Items Pie Chart -->
  <div class="analytics-card" *ngIf="!mostStockPieLoading">
    <div class="card-header">
      <div class="card-icon" style="background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);">
        <i class="fas fa-boxes"></i>
      </div>
      <div>
        <div class="card-title">Most Stock Items</div>
        <div class="card-description">Top 10 items by stock quantity</div>
      </div>
    </div>
    <div echarts [options]="mostStockPieOption" style="height: 400px;"></div>
  </div>

  <!-- Most Stock Items Loading State -->
  <div class="analytics-card" *ngIf="mostStockPieLoading">
    <div class="card-header">
      <div class="card-icon" style="background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);">
        <i class="fas fa-boxes"></i>
      </div>
      <div>
        <div class="card-title">Most Stock Items</div>
        <div class="card-description">Loading chart data...</div>
      </div>
    </div>
    <div class="loading">
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Most Dispose Items Pie Chart -->
  <div class="analytics-card" *ngIf="!mostDisposePieLoading">
    <div class="card-header">
      <div class="card-icon" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">
        <i class="fas fa-trash-alt"></i>
      </div>
      <div>
        <div class="card-title">Most Disposed Items</div>
        <div class="card-description">Top 10 items by disposal quantity</div>
      </div>
    </div>
    <div echarts [options]="mostDisposePieOption" style="height: 400px;"></div>
  </div>

  <!-- Most Dispose Items Loading State -->
  <div class="analytics-card" *ngIf="mostDisposePieLoading">
    <div class="card-header">
      <div class="card-icon" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">
        <i class="fas fa-trash-alt"></i>
      </div>
      <div>
        <div class="card-title">Most Disposed Items</div>
        <div class="card-description">Loading chart data...</div>
      </div>
    </div>
    <div class="loading">
      <div class="spinner"></div>
    </div>
  </div>

  <!-- Analytics Grid -->
  <div class="analytics-grid" *ngIf="advancedAnalytics && !loading">
    <!-- Top Used Categories -->
    <div class="analytics-card">
      <div class="card-header">
        <div class="card-icon categories-icon">
          <i class="fas fa-chart-pie"></i>
        </div>
        <div>
          <div class="card-title">Top Used Categories</div>
          <div class="card-description">Most frequently used item categories</div>
        </div>
      </div>
      <div class="analytics-content" *ngIf="advancedAnalytics.topCategories && advancedAnalytics.topCategories.length > 0">
        <div class="analytics-item" *ngFor="let category of advancedAnalytics.topCategories.slice(0, 5)">
          <div class="item-name">{{ category.category }}</div>
          <div class="item-value">{{ formatNumber(category.usage) }}</div>
          <div class="item-percentage">{{ category.percentage }}%</div>
        </div>
      </div>
      <div class="no-data" *ngIf="!advancedAnalytics.topCategories || advancedAnalytics.topCategories.length === 0">
        <i class="fas fa-chart-pie"></i>
        <div>No category data available</div>
      </div>
    </div>

    <!-- Most Replaced Components -->
    <div class="analytics-card">
      <div class="card-header">
        <div class="card-icon components-icon">
          <i class="fas fa-chart-bar"></i>
        </div>
        <div>
          <div class="card-title">Most Replaced Components</div>
          <div class="card-description">Components with highest replacement frequency</div>
        </div>
      </div>
      <div class="analytics-content" *ngIf="advancedAnalytics.mostReplacedComponents && advancedAnalytics.mostReplacedComponents.length > 0">
        <div class="analytics-item" *ngFor="let component of advancedAnalytics.mostReplacedComponents.slice(0, 5)">
          <div class="item-name">{{ component.name }}</div>
          <div class="item-value">{{ formatNumber(component.replacementCount) }}</div>
        </div>
      </div>
      <div class="no-data" *ngIf="!advancedAnalytics.mostReplacedComponents || advancedAnalytics.mostReplacedComponents.length === 0">
        <i class="fas fa-chart-bar"></i>
        <div>No replacement data available</div>
      </div>
    </div>

    <!-- Average Component Lifespan -->
    <div class="analytics-card">
      <div class="card-header">
        <div class="card-icon lifespan-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div>
          <div class="card-title">Average Component Lifespan</div>
          <div class="card-description">Expected lifespan by category</div>
        </div>
      </div>
      <div class="analytics-content" *ngIf="advancedAnalytics.averageLifespan && advancedAnalytics.averageLifespan.length > 0">
        <div class="analytics-item" *ngFor="let lifespan of advancedAnalytics.averageLifespan.slice(0, 5)">
          <div class="item-name">{{ lifespan.category }}</div>
          <div class="item-value">{{ formatNumber(lifespan.averageLifespan, 1) }} days</div>
        </div>
      </div>
      <div class="no-data" *ngIf="!advancedAnalytics.averageLifespan || advancedAnalytics.averageLifespan.length === 0">
        <i class="fas fa-clock"></i>
        <div>No lifespan data available</div>
      </div>
    </div>

    <!-- Pending Requests -->
    <div class="analytics-card">
      <div class="card-header">
        <div class="card-icon requests-icon">
          <i class="fas fa-hourglass-half"></i>
        </div>
        <div>
          <div class="card-title">Pending Requests</div>
          <div class="card-description">Items awaiting approval</div>
        </div>
      </div>
      <div class="analytics-content" *ngIf="advancedAnalytics.pendingRequests && advancedAnalytics.pendingRequests.length > 0">
        <div class="analytics-item" *ngFor="let request of advancedAnalytics.pendingRequests.slice(0, 5)">
          <div class="item-name">{{ request.itemName }}</div>
          <div class="item-value">{{ formatNumber(request.quantity) }}</div>
        </div>
      </div>
      <div class="no-data" *ngIf="!advancedAnalytics.pendingRequests || advancedAnalytics.pendingRequests.length === 0">
        <i class="fas fa-hourglass-half"></i>
        <div>No pending requests</div>
      </div>
    </div>

    <!-- Low Stock Items -->
    <div class="analytics-card">
      <div class="card-header">
        <div class="card-icon" style="background: linear-gradient(135deg, #ffc107 0%, #ff8c00 100%);">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div>
          <div class="card-title">Low Stock Items</div>
          <div class="card-description">Items with low inventory levels</div>
        </div>
      </div>
      <div class="analytics-content" *ngIf="advancedAnalytics.lowStockItems && advancedAnalytics.lowStockItems.length > 0">
        <div class="analytics-item" *ngFor="let item of advancedAnalytics.lowStockItems.slice(0, 5)">
          <div class="item-name">{{ item.name }}</div>
          <div class="item-value">{{ formatNumber(item.quantity) }}</div>
        </div>
      </div>
      <div class="no-data" *ngIf="!advancedAnalytics.lowStockItems || advancedAnalytics.lowStockItems.length === 0">
        <i class="fas fa-exclamation-triangle"></i>
        <div>No low stock items</div>
      </div>
    </div>

    <!-- Out of Stock Items -->
    <div class="analytics-card">
      <div class="card-header">
        <div class="card-icon" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">
          <i class="fas fa-times-circle"></i>
        </div>
        <div>
          <div class="card-title">Out of Stock Items</div>
          <div class="card-description">Items with zero inventory</div>
        </div>
      </div>
      <div class="analytics-content" *ngIf="advancedAnalytics.outOfStockItems && advancedAnalytics.outOfStockItems.length > 0">
        <div class="analytics-item" *ngFor="let item of advancedAnalytics.outOfStockItems.slice(0, 5)">
          <div class="item-name">{{ item.name }}</div>
          <div class="item-value">{{ formatNumber(item.quantity) }}</div>
        </div>
      </div>
      <div class="no-data" *ngIf="!advancedAnalytics.outOfStockItems || advancedAnalytics.outOfStockItems.length === 0">
        <i class="fas fa-times-circle"></i>
        <div>No out of stock items</div>
      </div>
    </div>
  </div>

  <!-- Replacement Patterns Data -->
  <div class="analytics-card" *ngIf="advancedAnalytics?.replacementPatterns && !loading">
    <div class="card-header">
      <div class="card-icon patterns-icon">
        <i class="fas fa-chart-line"></i>
      </div>
      <div>
        <div class="card-title">Component Replacement Patterns</div>
        <div class="card-description">Analysis of replacement reasons and patterns</div>
      </div>
    </div>
    <div class="analytics-content">
      <div *ngFor="let pattern of getObjectEntries(advancedAnalytics.replacementPatterns.reasonPatterns)">
        <h4>{{ pattern[0] }}</h4>
        <div class="analytics-item" *ngFor="let reason of getObjectEntries(pattern[1])">
          <div class="item-name">{{ reason[0] }}</div>
          <div class="item-value">{{ reason[1] }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Automated Report Scheduling -->
  <div class="automated-schedule-section" *ngIf="automatedSchedule && isSuperAdmin()">
    <div class="schedule-header">
      <div class="schedule-title">
        <i class="fas fa-calendar-alt"></i>
        Automated Report Scheduling
      </div>
      <button class="btn btn-primary" (click)="saveAutomatedSchedule()" [disabled]="loading">
        <i class="fas fa-save"></i>
        Save Schedule
      </button>
    </div>
    
    <div class="schedule-form">
      <div class="form-group">
        <label class="form-label">Report Frequency</label>
        <select class="form-control" [(ngModel)]="scheduleForm.frequency">
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
          <option value="monthly">Monthly</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Report Time</label>
        <input type="time" class="form-control" [(ngModel)]="scheduleForm.time">
      </div>
      
      <div class="form-group">
        <label class="form-label">Recipients</label>
        <input type="email" class="form-control" [(ngModel)]="scheduleForm.recipients" placeholder="admin@example.com, manager@example.com">
      </div>
      
      <div class="form-group">
        <label class="form-label">Report Types</label>
        <div class="checkbox-group">
          <div class="checkbox-item">
            <input type="checkbox" id="stock" [(ngModel)]="scheduleForm.includeStock">
            <label for="stock">Stock Reports</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="disposal" [(ngModel)]="scheduleForm.includeDisposal">
            <label for="disposal">Disposal Reports</label>
          </div>
          <div class="checkbox-item">
            <input type="checkbox" id="analytics" [(ngModel)]="scheduleForm.includeAnalytics">
            <label for="analytics">Analytics Reports</label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- No Data State -->
  <div class="no-data" *ngIf="!advancedAnalytics && !loading">
    <i class="fas fa-chart-line"></i>
    <div>No analytics data available</div>
    <button class="btn btn-primary" (click)="refreshAnalytics()" style="margin-top: 15px;">
      <i class="fas fa-sync-alt"></i>
      Refresh Data
    </button>
  </div>
</div>